<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>MyBatis入门四</title>
    <link href="/2020/08/28/mybatis%E5%85%A5%E9%97%A8%E5%9B%9B/"/>
    <url>/2020/08/28/mybatis%E5%85%A5%E9%97%A8%E5%9B%9B/</url>
    
    <content type="html"><![CDATA[<p>MyBatis 的延迟加载，缓存，注解。</p><a id="more"></a><h1 id="1-MyBatis-延迟加载迟略"><a href="#1-MyBatis-延迟加载迟略" class="headerlink" title="1 MyBatis 延迟加载迟略"></a>1 MyBatis 延迟加载迟略</h1><blockquote><p>延迟加载：需要用到数据时才进行加载，不需要数据时就不加载。延迟加载也称懒加载。优点：先从单表查询，需要时再从关联表去关联查询，大大提高数据库性能，因为查询单表要比关联查询多张表速度要快。缺点：只有当需要用到数据时，才会进行数据库查询，这样在大批量数据查询时，因为查询工作也要消耗时间，所以可能造成用户等待时间变长，造成用户体验下降。</p></blockquote><h2 id="1-1-使用-association-实现一对一延迟加载"><a href="#1-1-使用-association-实现一对一延迟加载" class="headerlink" title="1.1 使用 association 实现一对一延迟加载"></a>1.1 使用 association 实现一对一延迟加载</h2><p>​    查询账户(Account)信息并且关联查询用户(User)信息。当我们需要查询用户(User)信息时再查询用户(User)信息。把对用户(User)信息的按需去查询就是延迟加载。</p><h3 id="1-1-1-账户的持久层DAO接口"><a href="#1-1-1-账户的持久层DAO接口" class="headerlink" title="1.1.1 账户的持久层DAO接口"></a>1.1.1 账户的持久层DAO接口</h3><pre><code class="hljs java"><span class="hljs-comment">//在Account里添加User属性</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IAccountDao</span> </span>&#123;    <span class="hljs-function">List&lt;Account&gt; <span class="hljs-title">findAllAccountUser</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h3 id="1-1-2-账户的持久层映射配置"><a href="#1-1-2-账户的持久层映射配置" class="headerlink" title="1.1.2 账户的持久层映射配置"></a>1.1.2 账户的持久层映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.pine.domain.Account&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;money&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;money&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span></span><span class="hljs-tag">                 <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;cn.pine.dao.IUserDao.findById&quot;</span></span><span class="hljs-tag">                 <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAllAccountUser&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;accountMap&quot;</span>&gt;</span>    SELECT * FROM account<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="1-1-3-在-SqlMapConfig-xml-中开启延迟加载策略"><a href="#1-1-3-在-SqlMapConfig-xml-中开启延迟加载策略" class="headerlink" title="1.1.3 在 SqlMapConfig.xml 中开启延迟加载策略"></a>1.1.3 在 SqlMapConfig.xml 中开启延迟加载策略</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>    <span class="hljs-comment">&lt;!--注意标签顺序，在typeAliases前--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lazyLoadingEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;aggressiveLazyLoading&quot;</span><span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">setting</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span></code></pre><h3 id="1-1-4-测试"><a href="#1-1-4-测试" class="headerlink" title="1.1.4 测试"></a>1.1.4 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAllAccountUser</span><span class="hljs-params">()</span></span>&#123;    List&lt;Account&gt; allAccountUser = accountDao.findAllAccountUser();&#125;</code></pre><p>由于只查询 Account 对象并没有取User对象，所以返回的结果中没有发出关联查询的语句</p><pre><code class="hljs reasonml">DEBUG <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IAccountDao</span>.</span></span>findAllAccountUser  - ==&gt;  Preparing: SELECT<span class="hljs-operator"> * </span>FROM account <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IAccountDao</span>.</span></span>findAllAccountUser  - ==&gt; Parameters: <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IAccountDao</span>.</span></span>findAllAccountUser  - &lt;==      Total: <span class="hljs-number">3</span></code></pre><p>在测试中取 User 对象时，返回结果便发出关联查询。</p><pre><code class="hljs routeros"><span class="hljs-builtin-name">DEBUG</span> IAccountDao.findAllAccountUser  - ==&gt;  Preparing: SELECT * <span class="hljs-keyword">FROM</span> account <span class="hljs-builtin-name">DEBUG</span> IAccountDao.findAllAccountUser  - ==&gt; Parameters: <span class="hljs-builtin-name">DEBUG</span> IAccountDao.findAllAccountUser  - &lt;==      Total: 3<span class="hljs-builtin-name">DEBUG</span>  cn.pine.dao.IUserDao.findById  - ==&gt;  Preparing: SELECT * <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> USER </span>WHERE id = ? <span class="hljs-builtin-name">DEBUG</span>  cn.pine.dao.IUserDao.findById  - ==&gt; Parameters: 46(Integer)<span class="hljs-builtin-name">DEBUG</span>  cn.pine.dao.IUserDao.findById  - &lt;==      Total: 1User&#123;<span class="hljs-attribute">id</span>=46, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;赵六&#x27;</span>, <span class="hljs-attribute">birthday</span>=Wed Mar 07 17:37:26 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;杭州&#x27;</span>&#125;<span class="hljs-builtin-name">DEBUG</span>  cn.pine.dao.IUserDao.findById  - ==&gt;  Preparing: SELECT * <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> USER </span>WHERE id = ? <span class="hljs-builtin-name">DEBUG</span>  cn.pine.dao.IUserDao.findById  - ==&gt; Parameters: 45(Integer)<span class="hljs-builtin-name">DEBUG</span>  cn.pine.dao.IUserDao.findById  - &lt;==      Total: 1User&#123;<span class="hljs-attribute">id</span>=45, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-attribute">birthday</span>=Sun Mar 04 12:04:06 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;深圳&#x27;</span>&#125;User&#123;<span class="hljs-attribute">id</span>=46, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;赵六&#x27;</span>, <span class="hljs-attribute">birthday</span>=Wed Mar 07 17:37:26 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;杭州&#x27;</span>&#125;</code></pre><hr><h2 id="1-2-使用-Collection-实现一对多延迟加载"><a href="#1-2-使用-Collection-实现一对多延迟加载" class="headerlink" title="1.2 使用 Collection 实现一对多延迟加载"></a>1.2 使用 Collection 实现一对多延迟加载</h2><p>查询用户(User)信息并且关联查询账户(Account)信息。</p><h3 id="1-2-1-在-User-中加入List-lt-Account-gt-属性"><a href="#1-2-1-在-User-中加入List-lt-Account-gt-属性" class="headerlink" title="1.2.1 在 User 中加入List&lt;Account&gt;属性"></a>1.2.1 在 User 中加入<code>List&lt;Account&gt;</code>属性</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> Date birthday;    <span class="hljs-keyword">private</span> String sex;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-keyword">private</span> List&lt;Account&gt; accounts;｝</code></pre><h3 id="1-2-2-用户和账户持久层接口的方法"><a href="#1-2-2-用户和账户持久层接口的方法" class="headerlink" title="1.2.2 用户和账户持久层接口的方法"></a>1.2.2 用户和账户持久层接口的方法</h3><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">lazyFindAllUserAccount</span><span class="hljs-params">()</span></span>;<span class="hljs-function">List&lt;Account&gt; <span class="hljs-title">findByUid</span><span class="hljs-params">(Integer uid)</span></span>;</code></pre><h3 id="1-2-3-用户持久层映射配置"><a href="#1-2-3-用户持久层映射配置" class="headerlink" title="1.2.3 用户持久层映射配置"></a>1.2.3 用户持久层映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;lazyUserMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sex&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;birthday&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;birthday&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;acccounts&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;cn.pine.domain.Account&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;cn.pine.dao.IAccountDao.findById&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;lazyFindAllUserAccount&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;lazyUserMap&quot;</span>&gt;</span>    SELECT * FROM user<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="1-2-4-账户持久层映射配置"><a href="#1-2-4-账户持久层映射配置" class="headerlink" title="1.2.4 账户持久层映射配置"></a>1.2.4 账户持久层映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.pine.domain.Account&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span>    SELECT * FROM account WHERE uid = #&#123;uid&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><p>测试</p><p>不取 User 中的 Account 集合时，返回结果中不发送关联查询</p><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testLazyFindAllUserAccount</span><span class="hljs-params">()</span></span>&#123;    List&lt;User&gt; users = userDao.lazyFindAllUserAccount();&#125;</code></pre><pre><code class="hljs routeros"><span class="hljs-builtin-name">DEBUG</span> UserDao.<span class="hljs-attribute">lazyFindAllUserAccount-</span>=Preparing: SELECT* <span class="hljs-keyword">FROM</span> user<span class="hljs-builtin-name">DEBUG</span> UserDao.lazyFindAllUserAccount <span class="hljs-attribute">-</span>=&gt; Parameters:<span class="hljs-builtin-name">DEBUG</span> UserDao.lazyFindAllUserAccount -&lt;== Total: 6</code></pre><hr><h1 id="2-MyBatis-缓存"><a href="#2-MyBatis-缓存" class="headerlink" title="2 MyBatis 缓存"></a>2 MyBatis 缓存</h1><p>​    MyBatis 通过缓存策略减少数据库的查询次数，提高性能，其中分为一级缓存与二级缓存。</p><h2 id="2-1-一级缓存"><a href="#2-1-一级缓存" class="headerlink" title="2.1 一级缓存"></a>2.1 一级缓存</h2><p>​    一级缓存是<code>SqlSession</code>范围的缓存，当调用SqlSession的修改，添加，删除，commit()，close()方法时，清空一级缓存。</p><p>设置<code>useCache</code>为true</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.pine.dao.IUserDao&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span> <span class="hljs-attr">useCache</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>        SELECT * FROM USER WHERE id = #&#123;id&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre><h3 id="2-1-2-测试"><a href="#2-1-2-测试" class="headerlink" title="2.1.2 测试"></a>2.1.2 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByID</span><span class="hljs-params">()</span></span>&#123;    User user1 = userDao.findById(<span class="hljs-number">41</span>);    System.out.println(<span class="hljs-string">&quot;第一次查询：&quot;</span> + user1);    User user2 = userDao.findById(<span class="hljs-number">41</span>);    System.out.println(<span class="hljs-string">&quot;第一次查询：&quot;</span> + user2);    System.out.println(user1==user2);&#125;</code></pre><p>这里查询两次，但是返回结果只发出一次查询，并且两次查询结果，地址值相同。由此可见缓存存在。</p><p>第一次发起查询用户 id 为 1 的用户信息，先去找缓存中是否有 id 为 41 的用户信息，如果没有，从数据库查询用户信息。</p><p>得到用户信息，将用户信息存储到一级缓存中。如果<code>sqlSession</code>去执行<code>commit</code>操作（执行插入、更新、删除），清空<code>SqlSession</code>中的一级缓存，这样做的目的为了让缓存中存储的是最新的信息，避免脏读。</p><p>第二次发起查询用户 id 为 1 的用户信息，先去找缓存中是否有 id 为 41 的用户信息，缓存中有，直接从缓存中获取用户信息。</p><pre><code class="hljs routeros"><span class="hljs-attribute">-</span>==&gt; Preparing: SELECT<span class="hljs-number">*F</span>ROM<span class="hljs-built_in"> USER </span>WHERE id = ?-&gt; Parameters: 41(Integer)-&lt;== Total: 1第一次查询：cn.pine.domain.User@4fcd19b3第一次查询：cn.pine.domain.User@4fcd19b3<span class="hljs-literal">true</span></code></pre><hr><h2 id="2-2-二级缓存"><a href="#2-2-二级缓存" class="headerlink" title="2.2 二级缓存"></a>2.2 二级缓存</h2><p>二级缓存是 mapper 映射级别的缓存，多个<code>SqlSession</code> 去操作同一个 <code>Mapper</code> 映射的<code>SQL</code> 语句，多个<code>SqlSession</code> 可以共用二级缓存，二级缓存是跨<code>SqlSession</code>的。</p><p>首先开启二级缓存。</p><p><code>SqlSession1</code>去查询用户信息，查询到用户信息会将查询数据存储到二级缓存中。</p><p><code>SqlSession2</code>去查询与<code>SqlSession1</code>相同的用户信息，首先会去缓存中找是否存在数据，如果存在直接从缓存中取出数据</p><p>如果<code>SqlSession3</code>去执行相同 mapper 映射下<code>SQL</code>，执行<code>commit</code>提交，将会清空该<code>mapper</code>映射下的二级缓存区域的数据。</p><h3 id="2-2-1-SqlMapConfig-xml-开启二级缓存"><a href="#2-2-1-SqlMapConfig-xml-开启二级缓存" class="headerlink" title="2.2.1 SqlMapConfig.xml  开启二级缓存"></a>2.2.1 SqlMapConfig.xml  开启二级缓存</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><span class="hljs-comment">&lt;!-- 开启二级缓存，默认开启 --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span></code></pre><h3 id="2-2-2-配置相关-Mapper-映射"><a href="#2-2-2-配置相关-Mapper-映射" class="headerlink" title="2.2.2 配置相关 Mapper 映射"></a>2.2.2 配置相关 Mapper 映射</h3><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.pine.dao.IUserDao&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 开启二级缓存的支持 --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span> <span class="hljs-attr">useCache</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>        SELECT * FROM USER WHERE id = #&#123;id&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre><h3 id="2-2-3-测试"><a href="#2-2-3-测试" class="headerlink" title="2.2.3 测试"></a>2.2.3 测试</h3><p>在执行第一次查询后关闭`SqlSession</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisTest</span> </span>&#123;    <span class="hljs-keyword">private</span> InputStream in;    <span class="hljs-keyword">private</span> SqlSessionFactory factory;    <span class="hljs-meta">@Before</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;        in = Resources.getResourceAsStream(<span class="hljs-string">&quot;SqlMapConfig.xml&quot;</span>);        SqlSessionFactoryBuilder builder = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder();        factory = builder.build(in);    &#125;    <span class="hljs-meta">@After</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;        in.close();    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByID</span><span class="hljs-params">()</span></span>&#123;        SqlSession session1 = factory.openSession();        SqlSession session2 = factory.openSession();        IUserDao dao1 = session1.getMapper(IUserDao.class);        IUserDao dao2 = session2.getMapper(IUserDao.class);        User user1 = dao1.findById(<span class="hljs-number">41</span>);        System.out.println(user1);        session1.close();        User user2 = dao2.findById(<span class="hljs-number">41</span>);        System.out.println(user2);        session2.close();        System.out.println(user1 == user2);    &#125;&#125;</code></pre><pre><code class="hljs routeros">- ==&gt; Preparing:SELECT* <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> USER </span>WHERE id = ?- ==&gt; Parameters: 41(Integer)- &lt;== Total: 1</code></pre><hr><h1 id="3-MyBatis-注解"><a href="#3-MyBatis-注解" class="headerlink" title="3 MyBatis 注解"></a>3 MyBatis 注解</h1><h2 id="3-1-常用注解"><a href="#3-1-常用注解" class="headerlink" title="3.1 常用注解"></a>3.1 常用注解</h2><pre><code class="hljs less"><span class="hljs-variable">@Insert:</span>实现新增<span class="hljs-variable">@Update</span>:实现更新<span class="hljs-variable">@Delete</span>:实现删除<span class="hljs-variable">@Select</span>:实现查询<span class="hljs-variable">@Result</span>:实现结果集封装<span class="hljs-variable">@Results</span>:可以与 <span class="hljs-variable">@Result</span> 一起使用，封装多个结果集<span class="hljs-variable">@ResultMap</span>:实现引用 <span class="hljs-variable">@Results</span> 定义的封装<span class="hljs-variable">@One</span>:实现一对一结果集封装<span class="hljs-variable">@Many</span>:实现一对多结果集封装<span class="hljs-variable">@SelectProvider</span>:实现动态 SQL 映射<span class="hljs-variable">@CacheNamespace</span>:实现注解二级缓存的使用</code></pre><h2 id="3-2-使用注解实现-CRUD-操作"><a href="#3-2-使用注解实现-CRUD-操作" class="headerlink" title="3.2 使用注解实现 CRUD 操作"></a>3.2 使用注解实现 CRUD 操作</h2><h3 id="3-2-1-实体类"><a href="#3-2-1-实体类" class="headerlink" title="3.2.1 实体类"></a>3.2.1 实体类</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<span class="hljs-comment">//与数据库列名不一致，省略getter,setter,toString</span>    <span class="hljs-keyword">private</span> Integer userId;    <span class="hljs-keyword">private</span> String userName;    <span class="hljs-keyword">private</span> Date userBirthday;    <span class="hljs-keyword">private</span> String userSex;    <span class="hljs-keyword">private</span> String userAddress;&#125;</code></pre><h3 id="3-2-2-注解方式开发持久层接口"><a href="#3-2-2-注解方式开发持久层接口" class="headerlink" title="3.2.2 注解方式开发持久层接口"></a>3.2.2 注解方式开发持久层接口</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IUserDao</span> </span>&#123;    <span class="hljs-meta">@Select(&quot;select * from user&quot;)</span>    <span class="hljs-meta">@Results(id = &quot;userMap&quot;,</span><span class="hljs-meta">                value = &#123;</span><span class="hljs-meta">                        @Result(id=true, column = &quot;id&quot;,property = &quot;userId&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;username&quot;,property=&quot;userName&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;sex&quot;,property=&quot;userSex&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;address&quot;,property=&quot;userAddress&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;birthday&quot;,property=&quot;userBirthday&quot;)</span><span class="hljs-meta">                &#125;)</span>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;    <span class="hljs-meta">@Select(&quot;select * from user where id = #&#123;uid&#125;&quot;)</span>    <span class="hljs-meta">@ResultMap(&quot;userMap&quot;)</span>    <span class="hljs-function">User <span class="hljs-title">findById</span><span class="hljs-params">(Integer userId)</span></span>;    <span class="hljs-meta">@Insert(&quot;insert into user(username,sex,birthday,address) values (#&#123;userName&#125;,#&#123;userSex&#125;,#&#123;userBirthday&#125;,#&#123;userAddress&#125;)&quot;)</span>    <span class="hljs-meta">@SelectKey(keyColumn = &quot;id&quot;,keyProperty = &quot;userId&quot;, resultType = Integer.class, before = false, statement = &#123;&quot;select last_insert_id()&quot;&#125;)</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveUser</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-meta">@Update(&quot;update user set username=#&#123;userName&#125;,address=#&#123;userAddress&#125;,sex=#&#123;userSex&#125;,birthday=#&#123;userBirthday&#125; where id =#&#123;userId&#125; &quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(User user)</span></span>;    <span class="hljs-meta">@Delete(&quot;delete from user where id = #&#123;uid&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(Integer userId)</span></span>;    <span class="hljs-meta">@Select(&quot;select count(*) from user&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">findTotal</span><span class="hljs-params">()</span></span>;    <span class="hljs-meta">@Select(&quot;select * from user where username like #&#123;username&#125;&quot;)</span>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByName</span><span class="hljs-params">(String name)</span></span>;&#125;</code></pre><h3 id="3-2-3-测试代码"><a href="#3-2-3-测试代码" class="headerlink" title="3.2.3 测试代码"></a>3.2.3 测试代码</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisTest</span> </span>&#123;    <span class="hljs-keyword">private</span> InputStream in;    <span class="hljs-keyword">private</span> SqlSessionFactory factory;    <span class="hljs-keyword">private</span> SqlSession session;    <span class="hljs-keyword">private</span> IUserDao userDao;    <span class="hljs-meta">@Before</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>&#123;        in = Resources.getResourceAsStream(<span class="hljs-string">&quot;SqlMapConfig.xml&quot;</span>);        SqlSessionFactoryBuilder builder = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder();        factory = builder.build(in);        session = factory.openSession();        userDao = session.getMapper(IUserDao.class);    &#125;    <span class="hljs-meta">@After</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception </span>&#123;        session.commit();        session.close();        in.close();    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAll</span><span class="hljs-params">()</span></span>&#123;        List&lt;User&gt; users = userDao.findAll();        <span class="hljs-keyword">for</span> (User user : users) &#123;            System.out.println(user);        &#125;    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSave</span><span class="hljs-params">()</span></span>&#123;        User user = <span class="hljs-keyword">new</span> User();        user.setUserName(<span class="hljs-string">&quot;Test_Save&quot;</span>);        user.setUserSex(<span class="hljs-string">&quot;男&quot;</span>);        user.setUserAddress(<span class="hljs-string">&quot;哈尔滨&quot;</span>);        user.setUserBirthday(<span class="hljs-keyword">new</span> Date());        <span class="hljs-keyword">int</span> res = userDao.saveUser(user);        System.out.println(<span class="hljs-string">&quot;数据库影响行数---&quot;</span> + res);        System.out.println(<span class="hljs-string">&quot;插入的主键值---&quot;</span> + user.getUserId());    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdate</span><span class="hljs-params">()</span> </span>&#123;        User user = userDao.findById(<span class="hljs-number">48</span>);        user.setUserBirthday(<span class="hljs-keyword">new</span> Date());        user.setUserSex(<span class="hljs-string">&quot;男&quot;</span>);        <span class="hljs-keyword">int</span> res = userDao.updateUser(user);        System.out.println(res);    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">int</span> res = userDao.deleteUser(<span class="hljs-number">51</span>);        System.out.println(res);    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindTotal</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">int</span> res = userDao.findTotal();        System.out.println(res);    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByName</span><span class="hljs-params">()</span> </span>&#123;        List&lt;User&gt; users = userDao.findByName(<span class="hljs-string">&quot;%四%&quot;</span>);        <span class="hljs-keyword">for</span>(User user : users) &#123;            System.out.println(user);        &#125;     &#125;&#125;</code></pre><hr><h2 id="3-3-使用注解实现复杂关系映射开发"><a href="#3-3-使用注解实现复杂关系映射开发" class="headerlink" title="3.3 使用注解实现复杂关系映射开发"></a>3.3 使用注解实现复杂关系映射开发</h2><pre><code class="hljs less"><span class="hljs-variable">@Results</span> 注解代替的是标签&lt;resultMap&gt;该注解中可以使用单个<span class="hljs-variable">@Result</span> 注解，也可以使用<span class="hljs-variable">@Result</span> 集合<span class="hljs-variable">@Results</span>（&#123;<span class="hljs-variable">@Result</span>（），<span class="hljs-variable">@Result</span>（）&#125;）或<span class="hljs-variable">@Results</span>（<span class="hljs-variable">@Result</span>（））<span class="hljs-variable">@Result</span> 注解代替了 &lt;id&gt;标签和&lt;result&gt;标签<span class="hljs-variable">@Result</span> 属性id 是否是主键字段column 数据库的列名property 需要装配的属性名one 需要使用的<span class="hljs-variable">@One</span> 注解（<span class="hljs-variable">@Result</span>（one=<span class="hljs-variable">@One</span>）（）））many 需要使用的<span class="hljs-variable">@Many</span> 注解（<span class="hljs-variable">@Result</span>（many=<span class="hljs-variable">@many</span>）（）））<span class="hljs-variable">@One</span> 注解（一对一）代替了&lt;assocation&gt;标签，是多表查询的关键，在注解中用来指定子查询返回单一对象。<span class="hljs-variable">@One</span> 注解属性介绍：select 指定用来多表查询的 sqlmapperfetchType 会覆盖全局的配置参数 lazyLoadingEnabled。。使用格式：<span class="hljs-variable">@Result</span>(column=<span class="hljs-string">&quot; &quot;</span>,property=<span class="hljs-string">&quot;&quot;</span>,one=<span class="hljs-variable">@One</span>(select=<span class="hljs-string">&quot;&quot;</span>))<span class="hljs-variable">@Many</span> 注解（多对一）代替了&lt;Collection&gt;标签,是是多表查询的关键，在注解中用来指定子查询返回对象集合。注意：聚集元素用来处理“一对多”的关系。需要指定映射的 Java 实体类的属性，属性的 javaType（一般为 ArrayList）但是注解中可以不定义；使用格式：<span class="hljs-variable">@Result</span>(property=<span class="hljs-string">&quot;&quot;</span>,column=<span class="hljs-string">&quot;&quot;</span>,many=<span class="hljs-variable">@Many</span>(select=<span class="hljs-string">&quot;&quot;</span>))</code></pre><h3 id="3-3-1-使用注解实现一对一复杂关系映射和延迟加载"><a href="#3-3-1-使用注解实现一对一复杂关系映射和延迟加载" class="headerlink" title="3.3.1 使用注解实现一对一复杂关系映射和延迟加载"></a>3.3.1 使用注解实现一对一复杂关系映射和延迟加载</h3><p>​    加载账户信息延迟加载用户信息。</p><h4 id="3-3-2-1-Account-实体类"><a href="#3-3-2-1-Account-实体类" class="headerlink" title="3.3.2.1 Account 实体类"></a>3.3.2.1 Account 实体类</h4><p>​    Account 类中添加 User 属性</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> Integer uid;    <span class="hljs-keyword">private</span> Double money;    <span class="hljs-keyword">private</span> User user;&#125;</code></pre><h4 id="3-3-2-2-账户的持久层接口使用注解配置"><a href="#3-3-2-2-账户的持久层接口使用注解配置" class="headerlink" title="3.3.2.2 账户的持久层接口使用注解配置"></a>3.3.2.2 账户的持久层接口使用注解配置</h4><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IAccountDao</span> </span>&#123;    <span class="hljs-meta">@Select(&quot;select * from account&quot;)</span>    <span class="hljs-meta">@Results(id=&quot;acountMap&quot;, value=&#123;</span><span class="hljs-meta">            @Result(id = true,column = &quot;id&quot;,property = &quot;id&quot;),</span><span class="hljs-meta">            @Result(column=&quot;uid&quot;,property=&quot;uid&quot;),</span><span class="hljs-meta">            @Result(column=&quot;money&quot;,property=&quot;money&quot;),</span><span class="hljs-meta">            @Result(column=&quot;uid&quot;,</span><span class="hljs-meta">                    property=&quot;user&quot;,</span><span class="hljs-meta">                    one=@One(select=&quot;cn.pine.dao.IUserDao.findById&quot;,</span><span class="hljs-meta">                            fetchType= FetchType.LAZY))</span><span class="hljs-meta">    &#125;)</span>    <span class="hljs-function">List&lt;Account&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h4 id="3-3-2-3-测试"><a href="#3-3-2-3-测试" class="headerlink" title="3.3.2.3 测试"></a>3.3.2.3 测试</h4><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAll</span><span class="hljs-params">()</span></span>&#123;    List&lt;Account&gt; accounts =  accountDao.findAll();    <span class="hljs-comment">/* 开启注释，只发送3次查询语句 </span><span class="hljs-comment">       关闭后，多发两次查询</span><span class="hljs-comment">    for (Account account : accounts) &#123;</span><span class="hljs-comment">        System.out.println(account);</span><span class="hljs-comment">        System.out.println(account.getUser());</span><span class="hljs-comment">    &#125;</span><span class="hljs-comment">    */</span>&#125;</code></pre><hr><h3 id="3-3-2-使用注解实现一对多复杂关系映射和延迟加载"><a href="#3-3-2-使用注解实现一对多复杂关系映射和延迟加载" class="headerlink" title="3.3.2 使用注解实现一对多复杂关系映射和延迟加载"></a>3.3.2 使用注解实现一对多复杂关系映射和延迟加载</h3><p>​    加载用户信息，延迟加载账户信息。</p><h4 id="3-3-2-1-User-类加入List-lt-Account-gt"><a href="#3-3-2-1-User-类加入List-lt-Account-gt" class="headerlink" title="3.3.2.1 User 类加入List&lt;Account&gt;"></a>3.3.2.1 User 类加入<code>List&lt;Account&gt;</code></h4><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer userId;    <span class="hljs-keyword">private</span> String userName;    <span class="hljs-keyword">private</span> Date userBirthday;    <span class="hljs-keyword">private</span> String userSex;    <span class="hljs-keyword">private</span> String userAddress;    <span class="hljs-keyword">private</span> List&lt;Account&gt; accounts;&#125;</code></pre><h4 id="3-3-2-2-注解配置用户持久层"><a href="#3-3-2-2-注解配置用户持久层" class="headerlink" title="3.3.2.2 注解配置用户持久层"></a>3.3.2.2 注解配置用户持久层</h4><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IUserDao</span> </span>&#123;    <span class="hljs-meta">@Select(&quot;select * from user&quot;)</span>    <span class="hljs-meta">@Results(id = &quot;userMap&quot;,</span><span class="hljs-meta">                value = &#123;</span><span class="hljs-meta">                        @Result(id=true, column = &quot;id&quot;,property = &quot;userId&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;username&quot;,property=&quot;userName&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;sex&quot;,property=&quot;userSex&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;address&quot;,property=&quot;userAddress&quot;),</span><span class="hljs-meta">                        @Result(column=&quot;birthday&quot;,property=&quot;userBirthday&quot;),</span><span class="hljs-meta">                        @Result(column = &quot;id&quot;,property = &quot;accounts&quot;,</span><span class="hljs-meta">                            many = @Many(</span><span class="hljs-meta">                                    select = &quot;cn.pine.dao.IAccountDao.findByUid&quot;,</span><span class="hljs-meta">                                    fetchType = FetchType.LAZY</span><span class="hljs-meta">                            ))</span><span class="hljs-meta">                &#125;)</span>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h4 id="3-3-2-3-注解配置账户持久层"><a href="#3-3-2-3-注解配置账户持久层" class="headerlink" title="3.3.2.3 注解配置账户持久层"></a>3.3.2.3 注解配置账户持久层</h4><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IAccountDao</span> </span>&#123;        <span class="hljs-meta">@Select(&quot;select * from account where uid = #&#123;uid&#125;&quot;)</span>    <span class="hljs-function">List&lt;Account&gt; <span class="hljs-title">findByUid</span><span class="hljs-params">(Integer userId)</span></span>;&#125;</code></pre><h4 id="3-3-2-4-测试"><a href="#3-3-2-4-测试" class="headerlink" title="3.3.2.4 测试"></a>3.3.2.4 测试</h4><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAll</span><span class="hljs-params">()</span></span>&#123;    List&lt;User&gt; users = userDao.findAll();   <span class="hljs-comment">/* for (User user : users) &#123;</span><span class="hljs-comment">        System.out.println(&quot;----每个用户的信息-----&quot;);</span><span class="hljs-comment">        System.out.println(user);</span><span class="hljs-comment">        System.out.println(user.getAccounts());</span><span class="hljs-comment">    &#125;*/</span>&#125;</code></pre><h2 id="3-4-基于注解的二级缓存"><a href="#3-4-基于注解的二级缓存" class="headerlink" title="3.4 基于注解的二级缓存"></a>3.4 基于注解的二级缓存</h2><h3 id="3-4-1-SqlMapConfig-xml-开启二级缓存支持"><a href="#3-4-1-SqlMapConfig-xml-开启二级缓存支持" class="headerlink" title="3.4.1 SqlMapConfig.xml 开启二级缓存支持"></a>3.4.1 SqlMapConfig.xml 开启二级缓存支持</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span></code></pre><p>3.4.2 持久层接口使用注解配置耳机缓存</p><pre><code class="hljs java"><span class="hljs-meta">@CacheNamespace</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IUserDao</span> </span>&#123;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>框架</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MyBatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatis入门三</title>
    <link href="/2020/08/27/mybatis%E5%85%A5%E9%97%A8%E4%B8%89/"/>
    <url>/2020/08/27/mybatis%E5%85%A5%E9%97%A8%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<p>MyBatis 的事务控制，动态 SQL 语句与多表查询。</p><a id="more"></a><h1 id="1-MyBatis-的事务控制"><a href="#1-MyBatis-的事务控制" class="headerlink" title="1 MyBatis 的事务控制"></a>1 MyBatis 的事务控制</h1><p>在 MyBatis 中事务不是自动提交的主要原因是从连接池取出连接，会调<code>connection.setAutocommit(false)</code>方法,使得在默认情况下，需要手动提交事务。设置自动事务提交的方法：创建 SqlSession 对象时使用<code>sqlSessionFactory.openSession(true)</code>方法实现事务的自动提交。</p><hr><h1 id="2-MyBatis-的动态-SQL-语句"><a href="#2-MyBatis-的动态-SQL-语句" class="headerlink" title="2 MyBatis 的动态 SQL 语句"></a>2 MyBatis 的动态 SQL 语句</h1><h2 id="2-1-lt-if-gt-标签"><a href="#2-1-lt-if-gt-标签" class="headerlink" title="2.1 &lt;if&gt; 标签"></a>2.1 &lt;if&gt; 标签</h2><h3 id="2-1-1-持久层-Dao-接口"><a href="#2-1-1-持久层-Dao-接口" class="headerlink" title="2.1.1 持久层 Dao 接口"></a>2.1.1 持久层 Dao 接口</h3><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByUser</span><span class="hljs-params">(User user)</span></span>;</code></pre><h3 id="2-1-2-映射配置"><a href="#2-1-2-映射配置" class="headerlink" title="2.1.2 映射配置"></a>2.1.2 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>    SELECT * from user USER WHERE 1 = 1    <span class="hljs-comment">&lt;!-- test属性中写对象属性名--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;username != null and username != &#x27;&#x27; &quot;</span>&gt;</span>        AND username LIKE #&#123;username&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;address != null&quot;</span>&gt;</span>        AND address like #&#123;address&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="2-1-3-测试"><a href="#2-1-3-测试" class="headerlink" title="2.1.3 测试"></a>2.1.3 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByUser</span><span class="hljs-params">()</span></span>&#123;    User u = <span class="hljs-keyword">new</span> User();    u.setUsername(<span class="hljs-string">&quot;%甲%&quot;</span>);    u.setAddress(<span class="hljs-string">&quot;%北&quot;</span>);    List&lt;User&gt; users = userDao.findByUser(u);    <span class="hljs-keyword">for</span> (User user : users) &#123;        System.out.println(user);    &#125;&#125;</code></pre><p>返回结果</p><p><code>User&#123;id=41, username=&#39;甲&#39;, birthday=Tue Feb 27 17:47:08 CST 2018, sex=&#39;男&#39;, address=&#39;北京&#39;&#125;</code></p><p>其中返回结果显示的 SQL 语句为<code>SELECT * from user USER WHERE 1 = 1 AND username LIKE ? AND address like ?</code></p><hr><h2 id="2-2-lt-where-gt-标签"><a href="#2-2-lt-where-gt-标签" class="headerlink" title="2.2 &lt;where&gt; 标签"></a>2.2 &lt;where&gt; 标签</h2><h3 id="2-2-1-映射配置"><a href="#2-2-1-映射配置" class="headerlink" title="2.2.1 映射配置"></a>2.2.1 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;defaultSql&quot;</span>&gt;</span>    SELECT * FROM USER<span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByUser&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;defaultSql&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;username != null and username != &#x27;&#x27;&quot;</span> &gt;</span>            and username like #&#123;username&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;address != null&quot;</span>&gt;</span>            and address like #&#123;address&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="2-2-2-测试"><a href="#2-2-2-测试" class="headerlink" title="2.2. 2 测试"></a>2.2. 2 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByUser</span><span class="hljs-params">()</span></span>&#123;    User u = <span class="hljs-keyword">new</span> User();    u.setUsername(<span class="hljs-string">&quot;%甲%&quot;</span>);    u.setAddress(<span class="hljs-string">&quot;%北&quot;</span>);    List&lt;User&gt; users = userDao.findByUser(u);    <span class="hljs-keyword">for</span> (User user : users) &#123;        System.out.println(user);    &#125;&#125;</code></pre><p>返回结果</p><p><code>User&#123;id=41, username=&#39;甲&#39;, birthday=Tue Feb 27 17:47:08 CST 2018, sex=&#39;男&#39;, address=&#39;北京&#39;&#125;</code></p><p>返回结果中的 SQL 语句</p><p><code>SELECT * FROM USER WHERE username like ? and address like ?</code></p><hr><h2 id="2-3-lt-foreach-gt-标签"><a href="#2-3-lt-foreach-gt-标签" class="headerlink" title="2.3 &lt;foreach&gt; 标签"></a>2.3 &lt;foreach&gt; 标签</h2><p>查询需要传入多个用户信息时，需要封装参数，进行参数传递。例如：<code>SELECT * FROM USERS WHERE username LIKE &#39;%张%&#39; AND id IN (10,89,16)</code></p><h3 id="2-3-1-QueryIdVo-封装类"><a href="#2-3-1-QueryIdVo-封装类" class="headerlink" title="2.3.1 QueryIdVo 封装类"></a>2.3.1 QueryIdVo 封装类</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryIdVo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> List&lt;Integer&gt; ids;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title">getIds</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> ids;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setIds</span><span class="hljs-params">(List&lt;Integer&gt; ids)</span> </span>&#123;        <span class="hljs-keyword">this</span>.ids = ids;    &#125;&#125;</code></pre><h3 id="2-3-2-持久层-Dao-接口"><a href="#2-3-2-持久层-Dao-接口" class="headerlink" title="2.3.2  持久层 Dao 接口"></a>2.3.2  持久层 Dao 接口</h3><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findInIds</span><span class="hljs-params">(QueryIdVo vo)</span></span>;</code></pre><h3 id="2-3-3-映射配置"><a href="#2-3-3-映射配置" class="headerlink" title="2.3.3 映射配置"></a>2.3.3 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findInIds&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.pine.domain.QueryIdVo&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;defaultSql&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;ids != null and ids.size() &gt; 0&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;id in (&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span>                #&#123;uid&#125;            <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="2-3-4-测试"><a href="#2-3-4-测试" class="headerlink" title="2.3.4 测试"></a>2.3.4 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByInIds</span><span class="hljs-params">()</span></span>&#123;    QueryIdVo vo = <span class="hljs-keyword">new</span> QueryIdVo();    List&lt;Integer&gt; ids = <span class="hljs-keyword">new</span> ArrayList&lt;Integer&gt;();    ids.add(<span class="hljs-number">41</span>);    ids.add(<span class="hljs-number">45</span>);    ids.add(<span class="hljs-number">42</span>);    vo.setIds(ids);    List&lt;User&gt; users = userDao.findInIds(vo);    <span class="hljs-keyword">for</span> (User user : users) &#123;        System.out.println(user);    &#125;&#125;</code></pre><p>返回结果</p><pre><code class="hljs routeros">User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;王一&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;User&#123;<span class="hljs-attribute">id</span>=42, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;张三&#x27;</span>, <span class="hljs-attribute">birthday</span>=Fri Mar 02 15:09:37 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;上海&#x27;</span>&#125;User&#123;<span class="hljs-attribute">id</span>=45, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-attribute">birthday</span>=Sun Mar 04 12:04:06 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;深圳&#x27;</span>&#125;返回的SQL语句SELECT * <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> USER </span>WHERE id <span class="hljs-keyword">in</span> ( ? , ? , ? )</code></pre><hr><h1 id="3-MyBatis-多表查询"><a href="#3-MyBatis-多表查询" class="headerlink" title="3 MyBatis 多表查询"></a>3 MyBatis 多表查询</h1><h2 id="3-1-多对一查询"><a href="#3-1-多对一查询" class="headerlink" title="3.1 多对一查询"></a>3.1 多对一查询</h2><p>​    以用户（User）和账户（Account）为模型，一个用户可以拥有多个账户，从账户信息出发关联查询用户信息为多对一查询，但是本质上是一对一查询，因为一个账户只能对应一个用户。而从用户出发，查新用户下的账户信息为一对多查询，因为一个用户对应多个账户。</p><h3 id="3-1-1-以账户关联查询用户方式一"><a href="#3-1-1-以账户关联查询用户方式一" class="headerlink" title="3.1.1 以账户关联查询用户方式一"></a>3.1.1 以账户关联查询用户方式一</h3><h4 id="3-1-1-1-账户信息实体类"><a href="#3-1-1-1-账户信息实体类" class="headerlink" title="3.1.1.1 账户信息实体类"></a>3.1.1.1 账户信息实体类</h4><pre><code class="hljs java"><span class="hljs-comment">//省略getter，setter和toString方法</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> Integer uid;    <span class="hljs-keyword">private</span> Double money;&#125;</code></pre><h4 id="3-1-1-2-AccountUser-类"><a href="#3-1-1-2-AccountUser-类" class="headerlink" title="3.1.1.2 AccountUser 类"></a>3.1.1.2 AccountUser 类</h4><p>定义 AccountUser 类来封装关联查询结果，要求包含账户信息与用户信息。</p><pre><code class="hljs java"><span class="hljs-comment">//省略getter和setter方法</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccoutUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Account</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.toString() + <span class="hljs-string">&quot;AccoutUser&#123;&quot;</span> +                <span class="hljs-string">&quot;username=&#x27;&quot;</span> + username + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&quot;, address=&#x27;&quot;</span> + address + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +                <span class="hljs-string">&#x27;&#125;&#x27;</span>;    &#125;&#125;</code></pre><h4 id="3-1-1-3-账户的持久层-Dao-接口"><a href="#3-1-1-3-账户的持久层-Dao-接口" class="headerlink" title="3.1.1.3 账户的持久层 Dao 接口"></a>3.1.1.3 账户的持久层 Dao 接口</h4><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IAccountDao</span> </span>&#123;    <span class="hljs-function">List&lt;AccoutUser&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h4 id="3-1-1-4-AccountDao-xml-映射配置"><a href="#3-1-1-4-AccountDao-xml-映射配置" class="headerlink" title="3.1.1.4 AccountDao.xml 映射配置"></a>3.1.1.4 AccountDao.xml 映射配置</h4><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.pine.dao.IAccountDao&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.pine.domain.AccoutUser&quot;</span>&gt;</span>        SELECT a.*,u.username,u.address FROM account a, user u WHERE a.uid = u.id;    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre><p>3.1.1.6 测试</p><p>Acoount表：</p><table><thead><tr><th>id</th><th>uid</th><th>money</th></tr></thead><tbody><tr><td>1</td><td>46</td><td>1000</td></tr><tr><td>2</td><td>45</td><td>1000</td></tr><tr><td>3</td><td>46</td><td>2000</td></tr></tbody></table><p>user表：</p><table><thead><tr><th>id</th><th>username</th><th>birthday</th><th>sex</th><th>address</th></tr></thead><tbody><tr><td>41</td><td>王一</td><td>27/2/2018 17:47:08</td><td>男</td><td>北京</td></tr><tr><td>42</td><td>张三</td><td>2/3/2018 15:09:37</td><td>女</td><td>上海</td></tr><tr><td>43</td><td>张五</td><td>4/3/2018 11:34:34</td><td>女</td><td>广州</td></tr><tr><td>45</td><td>李四</td><td>4/3/2018 12:04:06</td><td>男</td><td>深圳</td></tr><tr><td>46</td><td>赵六</td><td>7/3/2018 17:37:26</td><td>男</td><td>杭州</td></tr><tr><td>48</td><td>钱七</td><td>8/3/2018 11:44:00</td><td>女</td><td>成都</td></tr></tbody></table><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAll</span><span class="hljs-params">()</span></span>&#123;    List&lt;AccoutUser&gt; accoutUsers = accountDao.findAll();    <span class="hljs-keyword">for</span> (AccoutUser accoutUser : accoutUsers) &#123;        System.out.println(accoutUser);    &#125;&#125;</code></pre><p>返回结果</p><pre><code class="hljs routeros">Account&#123;<span class="hljs-attribute">id</span>=1, <span class="hljs-attribute">uid</span>=46, <span class="hljs-attribute">money</span>=1000.0&#125;AccoutUser&#123;<span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;赵六&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;杭州&#x27;</span>&#125;Account&#123;<span class="hljs-attribute">id</span>=2, <span class="hljs-attribute">uid</span>=45, <span class="hljs-attribute">money</span>=1000.0&#125;AccoutUser&#123;<span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;深圳&#x27;</span>&#125;Account&#123;<span class="hljs-attribute">id</span>=3, <span class="hljs-attribute">uid</span>=46, <span class="hljs-attribute">money</span>=2000.0&#125;AccoutUser&#123;<span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;赵六&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;杭州&#x27;</span>&#125;</code></pre><h3 id="3-1-2-以账户关联查询用户方式二"><a href="#3-1-2-以账户关联查询用户方式二" class="headerlink" title="3.1.2 以账户关联查询用户方式二"></a>3.1.2 以账户关联查询用户方式二</h3><p>通过在 Account 类中加入 User 属性，Dao 接口方法返回值修改为<code>List&lt;Acoount&gt;</code>。</p><p>最后在映射配置中通过 <code>resultMap</code>建立对应关系，如下：</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;account&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountMap&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;aid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;money&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;money&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- 它是用于指定从表方的引用实体属性的 --&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sex&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;birthday&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;birthday&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;accountMap&quot;</span>&gt;</span>select u.*,a.id as aid,a.uid,a.money from account a,user u where a.uid =u.id;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><hr><h2 id="3-2-一对多查询"><a href="#3-2-一对多查询" class="headerlink" title="3.2 一对多查询"></a>3.2 一对多查询</h2><p>查询用户信息及其关联的账户信息，为一对多查询。（使用做外链接，因为可能有的用户没有账户信息）</p><h3 id="3-2-1-User-类中加入List-lt-Account-gt-属性"><a href="#3-2-1-User-类中加入List-lt-Account-gt-属性" class="headerlink" title="3.2.1 User 类中加入List&lt;Account&gt;属性"></a>3.2.1 User 类中加入<code>List&lt;Account&gt;</code>属性</h3><pre><code class="hljs java"><span class="hljs-comment">//省略了getter，setter和toString方法</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> Date birthday;    <span class="hljs-keyword">private</span> String sex;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-keyword">private</span> List&lt;Account&gt; accounts;&#125;</code></pre><h3 id="3-2-2-用户持久层-Dao-接口加入查询方法"><a href="#3-2-2-用户持久层-Dao-接口加入查询方法" class="headerlink" title="3.2.2 用户持久层 Dao 接口加入查询方法"></a>3.2.2 用户持久层 Dao 接口加入查询方法</h3><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAllUserAccount</span><span class="hljs-params">()</span></span>;</code></pre><h3 id="3-2-3-映射配置"><a href="#3-2-3-映射配置" class="headerlink" title="3.2.3 映射配置"></a>3.2.3 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sex&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;birthday&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;birthday&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- collection 定义账户信息</span><span class="hljs-comment">property 关联查询User对象的属性</span><span class="hljs-comment">ofType 指定List中的对象类型--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;accounts&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;cn.pine.domain.Account&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;aid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;uid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;uid&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;money&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;money&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAllUserAccount&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;userMap&quot;</span>&gt;</span>    SELECT u.*, a.id as aid, a.uid, a.money FROM USER u LEFT OUTER JOIN account a on u.id=a.uid<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="3-2-4-测试"><a href="#3-2-4-测试" class="headerlink" title="3.2.4  测试"></a>3.2.4  测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAllUserAccount</span><span class="hljs-params">()</span></span>&#123;    List&lt;User&gt; users = userDao.findAllUserAccount();    <span class="hljs-keyword">for</span> (User user : users) &#123;        System.out.println(<span class="hljs-string">&quot;------每个用户的内容----------&quot;</span>);        System.out.println(user);        System.out.println(user.getAccounts());    &#125;&#125;&#125;</code></pre><p>返回结果</p><pre><code class="hljs routeros">------每个用户的内容----------User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;王一&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;[]------每个用户的内容----------User&#123;<span class="hljs-attribute">id</span>=42, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;张三&#x27;</span>, <span class="hljs-attribute">birthday</span>=Fri Mar 02 15:09:37 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;上海&#x27;</span>&#125;[]------每个用户的内容----------User&#123;<span class="hljs-attribute">id</span>=43, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;张五&#x27;</span>, <span class="hljs-attribute">birthday</span>=Sun Mar 04 11:34:34 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;广州&#x27;</span>&#125;[]------每个用户的内容----------User&#123;<span class="hljs-attribute">id</span>=45, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-attribute">birthday</span>=Sun Mar 04 12:04:06 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;深圳&#x27;</span>&#125;[Account&#123;<span class="hljs-attribute">id</span>=2, <span class="hljs-attribute">uid</span>=45, <span class="hljs-attribute">money</span>=1000.0&#125;]------每个用户的内容----------User&#123;<span class="hljs-attribute">id</span>=46, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;赵六&#x27;</span>, <span class="hljs-attribute">birthday</span>=Wed Mar 07 17:37:26 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;杭州&#x27;</span>&#125;[Account&#123;<span class="hljs-attribute">id</span>=1, <span class="hljs-attribute">uid</span>=46, <span class="hljs-attribute">money</span>=1000.0&#125;, Account&#123;<span class="hljs-attribute">id</span>=3, <span class="hljs-attribute">uid</span>=46, <span class="hljs-attribute">money</span>=2000.0&#125;]------每个用户的内容----------User&#123;<span class="hljs-attribute">id</span>=48, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;钱七&#x27;</span>, <span class="hljs-attribute">birthday</span>=Thu Mar 08 11:44:00 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;成都&#x27;</span>&#125;[]</code></pre><hr><h2 id="3-3-多对多查询"><a href="#3-3-多对多查询" class="headerlink" title="3.3 多对多查询"></a>3.3 多对多查询</h2><h3 id="3-3-1-用户与角色的关系模型"><a href="#3-3-1-用户与角色的关系模型" class="headerlink" title="3.3.1  用户与角色的关系模型"></a>3.3.1  用户与角色的关系模型</h3><p>一个角色（Role）可以对应多个用户，一个用户（User）可对应多个角色，形成多对多关系。</p><p>通过查询角色关联查询所需要的 SQL 语句：</p><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> r.*,u.id uid, u.username username, u.birthday birthday, u.sex sex, u.address address<span class="hljs-keyword">FROM</span>  <span class="hljs-keyword">ROLE</span> r<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>  USER_ROLE ur<span class="hljs-keyword">ON</span> ( r.id = ur.rid)<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">USER</span> u<span class="hljs-keyword">ON</span> (ur.uid = u.id);</code></pre><h3 id="4-1-2-角色实体类"><a href="#4-1-2-角色实体类" class="headerlink" title="4.1.2 角色实体类"></a>4.1.2 角色实体类</h3><pre><code class="hljs java"><span class="hljs-comment">//省略getter,setter,toString方法</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Role</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer roleId;    <span class="hljs-keyword">private</span> String roleName;    <span class="hljs-keyword">private</span> String roleDesc;    <span class="hljs-keyword">private</span> List&lt;User&gt; users;&#125;</code></pre><h3 id="4-1-3-角色持久层-Dao-接口"><a href="#4-1-3-角色持久层-Dao-接口" class="headerlink" title="4.1.3 角色持久层  Dao 接口"></a>4.1.3 角色持久层  Dao 接口</h3><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IRoleDao</span> </span>&#123;    <span class="hljs-function">List&lt;Role&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre><h3 id="4-1-4-映射配置"><a href="#4-1-4-映射配置" class="headerlink" title="4.1.4 映射配置"></a>4.1.4 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;roleMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.pine.domain.Role&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;rid&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roleId&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;role_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roleName&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;role_desc&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;roleDesc&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;users&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;address&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;address&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sex&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;birthday&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;birthday&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAll&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;roleMap&quot;</span>&gt;</span>    SELECT u.*, r.id as rid, r.role_name, r.role_desc from role r LEFT outer JOIN user_role ur on r.id = ur.rid left outer join user u on u.id=ur.uid<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="4-1-5-测试"><a href="#4-1-5-测试" class="headerlink" title="4.1.5 测试"></a>4.1.5 测试</h3><pre><code class="hljs java"><span class="hljs-comment">//获得的动态代理对象应为session.getMapper(IRoleDao.class)</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAll</span><span class="hljs-params">()</span> </span>&#123;    List&lt;Role&gt; roles = roleDao.findAll();    <span class="hljs-keyword">for</span> (Role role : roles) &#123;        System.out.println(<span class="hljs-string">&quot;======每个角色的信息========&quot;</span>);        System.out.println(role);        System.out.println(role.getUsers());    &#125;&#125;</code></pre><p>返回结果</p><pre><code class="hljs routeros">======每个角色的信息========Role&#123;<span class="hljs-attribute">roleId</span>=1, <span class="hljs-attribute">roleName</span>=<span class="hljs-string">&#x27;院长&#x27;</span>, <span class="hljs-attribute">roleDesc</span>=<span class="hljs-string">&#x27;管理整个学院&#x27;</span>, users=[User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;王一&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;, User&#123;<span class="hljs-attribute">id</span>=45, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-attribute">birthday</span>=Sun Mar 04 12:04:06 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;深圳&#x27;</span>&#125;]&#125;[User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;王一&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;, User&#123;<span class="hljs-attribute">id</span>=45, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-attribute">birthday</span>=Sun Mar 04 12:04:06 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;深圳&#x27;</span>&#125;]======每个角色的信息========Role&#123;<span class="hljs-attribute">roleId</span>=2, <span class="hljs-attribute">roleName</span>=<span class="hljs-string">&#x27;总裁&#x27;</span>, <span class="hljs-attribute">roleDesc</span>=<span class="hljs-string">&#x27;管理整个公司&#x27;</span>, users=[User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;王一&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;]&#125;[User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;王一&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;]======每个角色的信息========Role&#123;<span class="hljs-attribute">roleId</span>=3, <span class="hljs-attribute">roleName</span>=<span class="hljs-string">&#x27;校长&#x27;</span>, <span class="hljs-attribute">roleDesc</span>=<span class="hljs-string">&#x27;管理整个学校&#x27;</span>, users=[]&#125;[]</code></pre>]]></content>
    
    
    <categories>
      
      <category>框架</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MyBatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MaBatis入门二</title>
    <link href="/2020/08/27/mybatis%E5%85%A5%E9%97%A8%E4%BA%8C/"/>
    <url>/2020/08/27/mybatis%E5%85%A5%E9%97%A8%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p>MyBatis进行 CRUD 操作，对结果进行封装。</p><a id="more"></a><h1 id="1-使用MyBatis进行CRUD操作"><a href="#1-使用MyBatis进行CRUD操作" class="headerlink" title="1 使用MyBatis进行CRUD操作"></a>1 使用MyBatis进行CRUD操作</h1><h2 id="1-1-根据ID查询user"><a href="#1-1-根据ID查询user" class="headerlink" title="1.1 根据ID查询user"></a>1.1 根据ID查询user</h2><h3 id="1-1-1-持久层接口添加findById方法"><a href="#1-1-1-持久层接口添加findById方法" class="headerlink" title="1.1.1  持久层接口添加findById方法"></a>1.1.1  持久层接口添加findById方法</h3><pre><code class="hljs java"><span class="hljs-function">User <span class="hljs-title">findById</span><span class="hljs-params">(Integer userId)</span></span>;</code></pre><h3 id="1-1-2-在IUserDao-xml映射配置文件中配置"><a href="#1-1-2-在IUserDao-xml映射配置文件中配置" class="headerlink" title="1.1.2 在IUserDao.xml映射配置文件中配置"></a>1.1.2 在IUserDao.xml映射配置文件中配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span>SELECT * FROM USER WHERE id = #&#123;uid&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><p>resultType：是指定结果集的类型</p><p>parameterType：用于指定传入参数的类型</p><p>#{}：代表占位符，作用相当于声明形参</p><h3 id="1-1-3-测试"><a href="#1-1-3-测试" class="headerlink" title="1.1.3 测试"></a>1.1.3 测试</h3><p>抽取测试类重复代码</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisTest</span> </span>&#123;    <span class="hljs-keyword">private</span> InputStream in;    <span class="hljs-keyword">private</span> SqlSessionFactory factory;    <span class="hljs-keyword">private</span> SqlSession session;    <span class="hljs-keyword">private</span> IUserDao userDao;    <span class="hljs-meta">@Before</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;        in = Resources.getResourceAsStream(<span class="hljs-string">&quot;SqlMapConfig.xml&quot;</span>);        SqlSessionFactoryBuilder builder = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder();        factory = builder.build(in);        session = factory.openSession();        userDao = session.getMapper(IUserDao.class);    &#125;    <span class="hljs-meta">@After</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;        session.commit();        session.close();        in.close();    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByID</span><span class="hljs-params">()</span></span>&#123;        User user = userDao.findById(<span class="hljs-number">41</span>);        System.out.println(user);    &#125;</code></pre><p>通过Junit 的Before与After注解来抽取重复的测试代码，分别在运行Test开始和结束之后运行，简化代码。</p><p>测试结果：</p><pre><code class="hljs angelscript"><span class="hljs-number">2020</span><span class="hljs-number">-08</span><span class="hljs-number">-24</span> <span class="hljs-number">15</span>:<span class="hljs-number">09</span>:<span class="hljs-number">50</span>,<span class="hljs-number">898</span> <span class="hljs-number">396</span>    [           main] DEBUG  cn.pine.dao.IUserDao.findById  - ==&gt;  Preparing: SELECT * FROM USER WHERE id = ? <span class="hljs-number">2020</span><span class="hljs-number">-08</span><span class="hljs-number">-24</span> <span class="hljs-number">15</span>:<span class="hljs-number">09</span>:<span class="hljs-number">50</span>,<span class="hljs-number">916</span> <span class="hljs-number">414</span>    [           main] DEBUG  cn.pine.dao.IUserDao.findById  - ==&gt; Parameters: <span class="hljs-number">41</span>(Integer)<span class="hljs-number">2020</span><span class="hljs-number">-08</span><span class="hljs-number">-24</span> <span class="hljs-number">15</span>:<span class="hljs-number">09</span>:<span class="hljs-number">50</span>,<span class="hljs-number">943</span> <span class="hljs-number">441</span>    [           main] DEBUG  cn.pine.dao.IUserDao.findById  - &lt;==      Total: <span class="hljs-number">1</span>User&#123;id=<span class="hljs-number">41</span>, username=<span class="hljs-string">&#x27;甲&#x27;</span>, birthday=Tue Feb <span class="hljs-number">27</span> <span class="hljs-number">17</span>:<span class="hljs-number">47</span>:<span class="hljs-number">08</span> CST <span class="hljs-number">2018</span>, sex=<span class="hljs-string">&#x27;男&#x27;</span>, address=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;</code></pre><hr><h2 id="1-2-保存操作"><a href="#1-2-保存操作" class="headerlink" title="1.2 保存操作"></a>1.2 保存操作</h2><h3 id="1-2-1-持久层接口中添加saveUser方法"><a href="#1-2-1-持久层接口中添加saveUser方法" class="headerlink" title="1.2.1 持久层接口中添加saveUser方法"></a>1.2.1 持久层接口中添加saveUser方法</h3><pre><code class="hljs java"><span class="hljs-comment">//返回数据库中影响行数</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveUser</span><span class="hljs-params">(User user)</span></span>;</code></pre><h3 id="1-2-2-映射配置"><a href="#1-2-2-映射配置" class="headerlink" title="1.2.2 映射配置"></a>1.2.2 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;saveUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">selectKey</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span>      SELECT last_insert_id();  <span class="hljs-tag">&lt;/<span class="hljs-name">selectKey</span>&gt;</span>    INSERT INTO USER (username,birthday,sex,address) VALUES (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre><p>parameterType：传入的参数为对象，填写全限定类名或别名</p><p>#{}中填写的是对象的属性，如user.username，但是由于在parameterType已经指定实体类，可以直接填写username。</p><p>selectKey标签中获取保存时的id值，并传给参数中的对象。</p><h3 id="1-2-3-测试"><a href="#1-2-3-测试" class="headerlink" title="1.2.3 测试"></a>1.2.3 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSaveUser</span><span class="hljs-params">()</span></span>&#123;User user = <span class="hljs-keyword">new</span> User();user.setUsername(<span class="hljs-string">&quot;saveUser&quot;</span>);user.setAddress(<span class="hljs-string">&quot;西安&quot;</span>);user.setSex(<span class="hljs-string">&quot;男&quot;</span>);user.setBirthday(<span class="hljs-keyword">new</span> Date());System.out.println(<span class="hljs-string">&quot;beforeSaving:&quot;</span> + user);userDao.saveUser(user);System.out.println(<span class="hljs-string">&quot;afterSaving:+user);</span><span class="hljs-string">&#125;</span></code></pre><p>测试结果</p><pre><code class="hljs routeros">beforeSaving:User&#123;<span class="hljs-attribute">id</span>=<span class="hljs-literal">null</span>, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;saveUser&#x27;</span>, <span class="hljs-attribute">birthday</span>=Mon Aug 24 15:25:51 CST 2020, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;西安&#x27;</span>&#125;afterSavingUser:&#123;<span class="hljs-attribute">id</span>=50, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;saveUser&#x27;</span>, <span class="hljs-attribute">birthday</span>=Mon Aug 24 15:25:51 CST 2020, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;西安&#x27;</span>&#125;</code></pre><hr><h2 id="1-3-更新操作"><a href="#1-3-更新操作" class="headerlink" title="1.3 更新操作"></a>1.3 更新操作</h2><h3 id="1-3-1-持久层接口添加updateUser方法"><a href="#1-3-1-持久层接口添加updateUser方法" class="headerlink" title="1.3.1 持久层接口添加updateUser方法"></a>1.3.1 持久层接口添加updateUser方法</h3><pre><code class="hljs java"><span class="hljs-comment">//返回影响记录行数</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(User user)</span></span>;</code></pre><h3 id="1-3-2-映射配置"><a href="#1-3-2-映射配置" class="headerlink" title="1.3.2 映射配置"></a>1.3.2 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span>&gt;</span>        UPDATE USER SET username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125;WHERE id=#&#123;id&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre><h3 id="1-3-3-测试"><a href="#1-3-3-测试" class="headerlink" title="1.3.3 测试"></a>1.3.3 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdateUser</span><span class="hljs-params">()</span> </span>&#123;User user = userDao.findById(<span class="hljs-number">48</span>);user.setAddress(<span class="hljs-string">&quot;成都&quot;</span>);<span class="hljs-keyword">int</span> res = userDao.updateUser(user);System.out.println(res);&#125;</code></pre><p>输出1，表示更新成功。</p><hr><h2 id="1-4-删除操作"><a href="#1-4-删除操作" class="headerlink" title="1.4 删除操作"></a>1.4 删除操作</h2><h3 id="1-4-1-持久层接口中添加deleteUser方法"><a href="#1-4-1-持久层接口中添加deleteUser方法" class="headerlink" title="1.4.1 持久层接口中添加deleteUser方法"></a>1.4.1 持久层接口中添加deleteUser方法</h3><pre><code class="hljs java"><span class="hljs-comment">//返回影响条数</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(Integer userId)</span></span>;</code></pre><h3 id="1-4-2-映射配置"><a href="#1-4-2-映射配置" class="headerlink" title="1.4.2 映射配置"></a>1.4.2 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;</span>        DELETE FROM USER WHERE id=#&#123;uid&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre><h3 id="1-4-3-测试"><a href="#1-4-3-测试" class="headerlink" title="1.4.3 测试"></a>1.4.3 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDeleteUser</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">int</span> res = userDao.deleteUser(<span class="hljs-number">50</span>);System.out.println(res);&#125;</code></pre><p>输出1，执行成功。</p><hr><h2 id="1-5-用户模糊查询"><a href="#1-5-用户模糊查询" class="headerlink" title="1.5 用户模糊查询"></a>1.5 用户模糊查询</h2><h3 id="1-5-1-持久层接口中添加findByName方法"><a href="#1-5-1-持久层接口中添加findByName方法" class="headerlink" title="1.5.1 持久层接口中添加findByName方法"></a>1.5.1 持久层接口中添加findByName方法</h3><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByName</span><span class="hljs-params">(String username)</span></span>;</code></pre><h3 id="1-5-2-映射配置"><a href="#1-5-2-映射配置" class="headerlink" title="1.5.2 映射配置"></a>1.5.2 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByName&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;String&quot;</span>&gt;</span>    SELECT * FROM USER WHERE username like #&#123;username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="1-5-3-测试"><a href="#1-5-3-测试" class="headerlink" title="1.5.3 测试"></a>1.5.3 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByName</span><span class="hljs-params">()</span> </span>&#123;    List&lt;User&gt; users = userDao.findByName(<span class="hljs-string">&quot;%甲%&quot;</span>);    <span class="hljs-keyword">for</span> (User user : users) &#123;        System.out.println(user);    &#125;&#125;</code></pre><p>返回结果</p><pre><code class="hljs routeros">User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;甲&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;</code></pre><hr><h2 id="1-6-查询使用聚合函数"><a href="#1-6-查询使用聚合函数" class="headerlink" title="1.6 查询使用聚合函数"></a>1.6 查询使用聚合函数</h2><h3 id="1-6-1-持久层接口添加方法"><a href="#1-6-1-持久层接口添加方法" class="headerlink" title="1.6.1 持久层接口添加方法"></a>1.6.1 持久层接口添加方法</h3><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">findTotal</span><span class="hljs-params">()</span></span>;</code></pre><h3 id="1-6-2-映射配置"><a href="#1-6-2-映射配置" class="headerlink" title="1.6.2 映射配置"></a>1.6.2 映射配置</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findTotal&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span>SELECT COUNT(*) FROM USER<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h3 id="1-6-3-测试"><a href="#1-6-3-测试" class="headerlink" title="1.6.3 测试"></a>1.6.3 测试</h3><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindTotal</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">int</span> total = userDao.findTotal();    System.out.println(total);&#125;</code></pre><p>返回6，为数据库中总条数。</p><hr><h1 id="2-包装对象传递输入参数"><a href="#2-包装对象传递输入参数" class="headerlink" title="2 包装对象传递输入参数"></a>2 包装对象传递输入参数</h1><h2 id="2-1-QueryVo包装类"><a href="#2-1-QueryVo包装类" class="headerlink" title="2.1  QueryVo包装类"></a>2.1  QueryVo包装类</h2><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryVo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> User user;    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> user;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUser</span><span class="hljs-params">(User user)</span> </span>&#123;        <span class="hljs-keyword">this</span>.user = user;    &#125;&#125;</code></pre><h2 id="2-2-持久层接口添加findByVo方法"><a href="#2-2-持久层接口添加findByVo方法" class="headerlink" title="2.2 持久层接口添加findByVo方法"></a>2.2 持久层接口添加findByVo方法</h2><pre><code class="hljs java"><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findByVo</span><span class="hljs-params">(QueryVo vo)</span></span>;</code></pre><h2 id="2-3-映射配置"><a href="#2-3-映射配置" class="headerlink" title="2.3 映射配置"></a>2.3 映射配置</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByVo&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;cn.pine.domain.QueryVo&quot;</span>&gt;</span>    SELECT * FROM USER WHERE username LIKE #&#123;user.username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h2 id="2-4-测试"><a href="#2-4-测试" class="headerlink" title="2.4 测试"></a>2.4 测试</h2><p>包装类作参数</p><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindByVo</span><span class="hljs-params">()</span></span>&#123;    QueryVo queryVo = <span class="hljs-keyword">new</span> QueryVo();    User user = <span class="hljs-keyword">new</span> User();    user.setUsername(<span class="hljs-string">&quot;%甲%&quot;</span>);    queryVo.setUser(user);    List&lt;User&gt; users = userDao.findByVo(queryVo);    <span class="hljs-keyword">for</span> (User u : users) &#123;        System.out.println(u);    &#125;&#125;</code></pre><p>返回结果</p><pre><code class="hljs routeros">User&#123;<span class="hljs-attribute">id</span>=41, <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;甲&#x27;</span>, <span class="hljs-attribute">birthday</span>=Tue Feb 27 17:47:08 CST 2018, <span class="hljs-attribute">sex</span>=<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-attribute">address</span>=<span class="hljs-string">&#x27;北京&#x27;</span>&#125;</code></pre><h1 id="3-输出结果封装"><a href="#3-输出结果封装" class="headerlink" title="3 输出结果封装"></a>3 输出结果封装</h1><p>​    当实体类属性与数据库表中的列名不一致时，对输出结果封装可以有两种方法。</p><ol><li>​    修改映射配置中的SQL语句，例如将原来的列明起与实体类属性一致的别名<strong>select columnName from tableName</strong> 换为 <strong>select columnName as propetyName from tableName</strong> </li><li>在接口配置文件映射配置中使用resultMap</li></ol><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;className&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;xxxMap&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;primary_column&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;propertyA&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;columnB&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;propertyB&quot;</span>/&gt;</span>...<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;columnG&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;propertyG&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;funcName&#x27;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;xxxMap&quot;</span>&gt;</span>select * from tableName<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><hr><h1 id="4-SqlMapConfig-xml配置内容"><a href="#4-SqlMapConfig-xml配置内容" class="headerlink" title="4 SqlMapConfig.xml配置内容"></a>4 SqlMapConfig.xml配置内容</h1><h2 id="4-1-配置内容与顺序"><a href="#4-1-配置内容与顺序" class="headerlink" title="4.1 配置内容与顺序"></a>4.1 配置内容与顺序</h2><pre><code class="hljs haml">-<span class="ruby">properties（属性）</span><span class="ruby">--property</span><span class="ruby">-settings（全局配置参数）</span><span class="ruby">--setting</span><span class="ruby">-typeAliases（类型别名）</span><span class="ruby">--typeAliase</span><span class="ruby">--package</span><span class="ruby">-typeHandlers（类型处理器）</span><span class="ruby">-objectFactory（对象工厂）</span><span class="ruby">-plugins（插件）</span><span class="ruby">-environments（环境集合属性对象）</span><span class="ruby">--environment（环境子属性对象）</span><span class="ruby">---transactionManager（事务管理）</span><span class="ruby">---dataSource（数据源）</span><span class="ruby">-mappers（映射器）</span><span class="ruby">--mapper</span><span class="ruby">--package</span></code></pre><h2 id="4-2-properties"><a href="#4-2-properties" class="headerlink" title="4.2 properties"></a>4.2 properties</h2><p>有两种方式进行配置</p><h3 id="4-2-1-第一种方式"><a href="#4-2-1-第一种方式" class="headerlink" title="4.2.1 第一种方式"></a>4.2.1 第一种方式</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbc.driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbc.url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbc.username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbc.password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></code></pre><h3 id="4-2-2-第二种方式"><a href="#4-2-2-第二种方式" class="headerlink" title="4.2.2 第二种方式"></a>4.2.2 第二种方式</h3><p>​    先在类路径下创建jdbcConfig.properties文件</p><pre><code class="hljs ini"><span class="hljs-attr">jdbc.driver</span>=com.mysql.jdbc.Driver<span class="hljs-attr">jdbc.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mybatis<span class="hljs-attr">jdbc.username</span>=root<span class="hljs-attr">jdbc.password</span>=root</code></pre><p>​     再配置propety标签</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;file:///绝对路径/jdbcConfig.properties&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></code></pre><p>​    经过以上properties的配置后，dataSource标签就可以引用以上配置</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span></code></pre><h2 id="4-3-typeAliases（类型别名）"><a href="#4-3-typeAliases（类型别名）" class="headerlink" title="4.3 typeAliases（类型别名）"></a>4.3 typeAliases（类型别名）</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 单个别名定义 --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;别名&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;全限定类名&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.pine.domain&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;其它包&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span></code></pre><h2 id="4-4-mappers（映射器）"><a href="#4-4-mappers（映射器）" class="headerlink" title="4.4 mappers（映射器）"></a>4.4 mappers（映射器）</h2><pre><code class="hljs routeros">1.使用相对于类路径的资源如：&lt;mapper <span class="hljs-attribute">resource</span>=<span class="hljs-string">&quot;com/pine/dao/IUserDao.xml&quot;</span> /&gt;2.使用 mapper 接口类路径如：&lt;mapper <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.pine.dao.UserDao&quot;</span>/&gt;注意：此种方法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。3.注册指定包下的所有 mapper 接口如：&lt;package <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;cn.pine.mybatis.mapper&quot;</span>/&gt;注意：此种方法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</code></pre>]]></content>
    
    
    <categories>
      
      <category>框架</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MyBatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatis入门一</title>
    <link href="/2020/08/26/maybatis%E5%85%A5%E9%97%A8%E4%B8%80/"/>
    <url>/2020/08/26/maybatis%E5%85%A5%E9%97%A8%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<p>MyBatis入门，接口层映射配置，SqlMapConfig配置。</p><a id="more"></a><h1 id="MyBatis简要了解"><a href="#MyBatis简要了解" class="headerlink" title="MyBatis简要了解"></a>MyBatis简要了解</h1><blockquote><p>MyBatis 本是<a href="https://baike.baidu.com/item/apache/6265">apache</a>的一个开源项目<a href="https://baike.baidu.com/item/iBatis">iBatis</a>, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。</p><p>iBATIS一词来源于“internet”和“abatis”的组合，是一个基于Java的<a href="https://baike.baidu.com/item/持久层/3584971">持久层</a>框架。iBATIS提供的持久层框架包括SQL Maps和Data Access Objects（DAOs）</p></blockquote><ul><li>MyBatis是一个 基于Java的持久层框架，它内部封装Jdbc，使开发者只需要关注SQL语句本身，不需关注处理加载驱动、创建连接、创建statement等过程。其通过XML或注解的方式配置所需的statement，通过Java对象和statement中的SQL的动态参数进行映射生成最终的SQL语句，最后由MyBatis框架执行SQL语句并将结果映射为Java对象并返回。</li></ul><h1 id="MyBatis框架快速入门"><a href="#MyBatis框架快速入门" class="headerlink" title="MyBatis框架快速入门"></a>MyBatis框架快速入门</h1><h2 id="下载-MyBatis-框架"><a href="#下载-MyBatis-框架" class="headerlink" title="下载 MyBatis 框架"></a>下载 MyBatis 框架</h2><p>下载地址：地址：<a href="https://github.com/mybatis/mybatis-3（本次使用的是3.4.5版本）">https://github.com/mybatis/mybatis-3（本次使用的是3.4.5版本）</a></p><h2 id="Maven-导入坐标"><a href="#Maven-导入坐标" class="headerlink" title="Maven 导入坐标"></a>Maven 导入坐标</h2><p>在pom.xml文件中导入坐标（同时要导入mysql-jdbc-java坐标）</p><pre><code class="hljs XML"> <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre><h2 id="工程目录结构"><a href="#工程目录结构" class="headerlink" title="工程目录结构"></a>工程目录结构</h2><p><img src="https://img-blog.csdnimg.cn/20200824103211890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BpbmVfZTM=,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="User表结构"><a href="#User表结构" class="headerlink" title="User表结构"></a>User表结构</h2><p><img src="https://img-blog.csdnimg.cn/20200824145319447.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="实体类User"><a href="#实体类User" class="headerlink" title="实体类User"></a>实体类User</h2><p>实现<strong>Serializable</strong>接口，成员变量声明使用包装类。这里省略了getter，setter方法还有toString方法。</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> Date birthday;    <span class="hljs-keyword">private</span> String sex;    <span class="hljs-keyword">private</span> String address;    <span class="hljs-keyword">private</span> List&lt;Account&gt; accounts;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Account&gt; <span class="hljs-title">getAccounts</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> accounts;    &#125;</code></pre><h2 id="持久层IUserDao"><a href="#持久层IUserDao" class="headerlink" title="持久层IUserDao"></a>持久层IUserDao</h2><p>放在src. main.java.cn.pine.dao下，声明操作数据库的方法</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IUserDao</span> </span>&#123;    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;｝</code></pre><h2 id="持久层接口的映射IUserDao-xml"><a href="#持久层接口的映射IUserDao-xml" class="headerlink" title="持久层接口的映射IUserDao.xml"></a>持久层接口的映射IUserDao.xml</h2><p>创建位置：必须和持久层接口在相同的包中。这里放在src.main.resources.cn.pine.dao下</p><p>名称：必须以持久层接口名称命名文件名，扩展名是.xml </p><pre><code class="hljs XML"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;cn.pine.dao.IUserDao&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- 配置查询所有操作 --&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span>&gt;</span>            select * from user  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre><p>SqlMapConfig.xml配置文件</p><p>SqlMapConfig.xml是MyBatis的全局配置文件，可以配置数据源，事务和映射文件等等信息。SqlMapConfig.xml配置文件放在resource目录下。</p><pre><code class="hljs XML"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 配置类别名 --&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.pine.domain.User&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 配置环境 --&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;mysql&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mysql&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">transactionManager</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 配置映射器 --&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;cn/pine/dao/IUserDao.xml&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre><p>测试MyBatis</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        <span class="hljs-comment">//1.读取配置文件</span>        InputStream in = Resources.getResourceAsStream(<span class="hljs-string">&quot;SqlMapConfig.xml&quot;</span>);        <span class="hljs-comment">//2.创建 SqlSessionFactory 的构建者对象</span>        SqlSessionFactoryBuilder builder = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder();        <span class="hljs-comment">//3.使用构建者创建工厂对象 SqlSessionFactory</span>        SqlSessionFactory factory = builder.build(in);        <span class="hljs-comment">//4.使用 SqlSessionFactory 生产 SqlSession 对象</span>        SqlSession session = factory.openSession();        <span class="hljs-comment">//5.使用 SqlSession 创建 dao 接口的代理对象</span>        IUserDao userDao = session.getMapper(IUserDao.class);        <span class="hljs-comment">//6.使用代理对象执行查询所有方法</span>        List&lt;User&gt; users = userDao.findAll();        <span class="hljs-keyword">for</span>(User user : users) &#123;            System.out.println(user);        &#125;        <span class="hljs-comment">//7.释放资源</span>        session.close();        in.close();    &#125; &#125;</code></pre><p>测试结果</p><p><img src="https://img-blog.csdnimg.cn/20200824112841616.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BpbmVfZTM=,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="基于注解配置的简单示例"><a href="#基于注解配置的简单示例" class="headerlink" title="基于注解配置的简单示例"></a>基于注解配置的简单示例</h2><p>在持久层接口中添加注解</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IUserDao</span> </span>&#123;    <span class="hljs-meta">@Select(&quot;select * from user&quot;)</span>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span></span>;&#125;</code></pre><p>修改SqlMapConfig.xml，且移除持久层接口的映射xml文件。</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.IUserDao&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>框架</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MyBatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python-day16-20</title>
    <link href="/2020/08/26/pyhthonExample16-20/"/>
    <url>/2020/08/26/pyhthonExample16-20/</url>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/jackfrued/Python-100-Days">https://github.com/jackfrued/Python-100-Days</a> Day-16-20手敲一遍。</p><a id="more"></a><h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><ul><li><h2 id="简单选择排序"><a href="#简单选择排序" class="headerlink" title="简单选择排序"></a>简单选择排序</h2><p> <strong>从列表第i元素开始算起，遍历之后的元素，把最小值与当前i元素进行交换。</strong></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">select_sort</span>(<span class="hljs-params">origin_items, comp=lambda x, y: x&lt; y</span>):</span>items = origin_items    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(items)):        min_index = i        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(i + <span class="hljs-number">1</span>, len(itmes)):            <span class="hljs-keyword">if</span> comp(items[j], items[min_index]):            min_index = j    items[i], items[min_index] = items[min_index], items[i]    <span class="hljs-keyword">return</span> items</code></pre></li><li><h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><p> <strong>两两比较，先把最大值放在最后。有发生元素交换就往反方向比较，把最小值放在前面。</strong></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bubble_sort</span>(<span class="hljs-params">origin_items, *, comp=lambda x, y: x &gt; y</span>):</span>    items = origin_items    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, len(items)):        swapped = <span class="hljs-literal">False</span>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(i - <span class="hljs-number">1</span>, len(items) - i):            <span class="hljs-keyword">if</span> comp(items[j], items[j + <span class="hljs-number">1</span>]):                items[j], items[j + <span class="hljs-number">1</span>] = items[j + <span class="hljs-number">1</span>], items[j]                swapped = <span class="hljs-literal">True</span>        <span class="hljs-keyword">if</span> swapped:            swapped = <span class="hljs-literal">False</span>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(len(items) - i - <span class="hljs-number">1</span>, i - <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>):                <span class="hljs-keyword">if</span> comp(items[j - <span class="hljs-number">1</span>], items[j]):                    items[j], items[j - <span class="hljs-number">1</span>] = items[j - <span class="hljs-number">1</span>], items[j]                    swapped = <span class="hljs-literal">True</span>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> swapped:            <span class="hljs-keyword">break</span><span class="hljs-keyword">return</span> items</code></pre></li><li><h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><p> <strong>把列表一直拆分为两个部分，然后两两合并为有序列表。</strong></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">merge_sort</span>(<span class="hljs-params">items, comp=lambda x, y: x &amp;lt;= y</span>):</span>    &amp;quot;&amp;quot;&amp;quot;归并排序&amp;quot;&amp;quot;&amp;quot;    <span class="hljs-keyword">if</span> len(items) &amp;lt; <span class="hljs-number">2</span>:        <span class="hljs-keyword">return</span> items[:]    mid = len(items) // <span class="hljs-number">2</span>    left = merge_sort(items[:mid], comp)    right = merge_sort(items[mid:], comp)    <span class="hljs-keyword">return</span> merge(left, right, comp)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">merge</span>(<span class="hljs-params">items1, items2, comp=lambda x, y: x &amp;lt;= y</span>):</span>    &amp;quot;&amp;quot;&amp;quot;合并（将两个有序列表合并成一个新的有序列表）&amp;quot;&amp;quot;&amp;quot;    items = []    index1, index2 = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> index1 &amp;lt; len(items1) <span class="hljs-keyword">and</span> index2 &amp;lt; len(items2):        <span class="hljs-keyword">if</span> comp(items1[index1], items2[index2]):            items.append(items1[index1])            index1 += <span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            items.append(items2[index2])            index2 += <span class="hljs-number">1</span>    items += items1[index1:]    items += items2[index2:]    <span class="hljs-keyword">return</span> items</code></pre></li><li><h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><p><strong>选择基准值，将基准值前后元素进行排序。</strong></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">quick_sort</span>(<span class="hljs-params">origin_items, comp=lambda x, y: x &lt;= y</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;快速排序&quot;&quot;&quot;</span>    items = origin_items[:]    _quick_sort(items, <span class="hljs-number">0</span>, len(items) - <span class="hljs-number">1</span>, comp)    <span class="hljs-keyword">return</span> items<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_quick_sort</span>(<span class="hljs-params">items, start, end, comp</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;递归调用划分和排序&quot;&quot;&quot;</span>    <span class="hljs-keyword">if</span> start &lt; end:        pos = _partition(items, start, end, comp)        _quick_sort(items, start, pos - <span class="hljs-number">1</span>, comp)        _quick_sort(items, pos + <span class="hljs-number">1</span>, end, comp)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_partition</span>(<span class="hljs-params">items, start, end, comp</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;划分(每次划分以最后一个值为基准值，把小于它的值放到前面去，最后把基准值放到中间)&quot;&quot;&quot;</span>    pivot = items[end]    i = start - <span class="hljs-number">1</span>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(start, end):        <span class="hljs-keyword">if</span> comp(items[j], pivot):            i += <span class="hljs-number">1</span>            items[i], items[j] = items[j], items[i]    items[i + <span class="hljs-number">1</span>], items[end] = items[end], items[i + <span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> i + <span class="hljs-number">1</span></code></pre></li></ul><h1 id="斐波那契函数"><a href="#斐波那契函数" class="headerlink" title="斐波那契函数"></a>斐波那契函数</h1><ul><li><p><strong>普通形式</strong></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">num</span>):</span>a, b = <span class="hljs-number">1</span>, <span class="hljs-number">1</span><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(num - <span class="hljs-number">1</span>):a, b = b, a + b<span class="hljs-keyword">return</span> a</code></pre></li><li><p><strong>生成器形式</strong></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib3</span>(<span class="hljs-params">num</span>):</span>    a, b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(num):        a, b = b, a + b        <span class="hljs-keyword">yield</span> a<span class="hljs-comment">#打印生成器生成值</span><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> fib(<span class="hljs-number">10</span>):print(x)</code></pre></li><li><p><strong>动态规划</strong></p><p><strong>（建立字典保存可能进行重复运算的中间结果（空间换时间））</strong></p><pre><code class="hljs python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> perf_counter<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">num, results=&#123;&#125;</span>):</span><span class="hljs-comment">#assert遇到条件不满足时直接返回错误</span>    <span class="hljs-keyword">assert</span> num &gt; <span class="hljs-number">0</span>    <span class="hljs-keyword">if</span> num <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>):        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>    <span class="hljs-keyword">try</span>:        <span class="hljs-keyword">return</span> results[num]    <span class="hljs-keyword">except</span> KeyError:        results[num] = fib(num - <span class="hljs-number">1</span>) + fib(num - <span class="hljs-number">2</span>)        <span class="hljs-keyword">return</span> results[num]<span class="hljs-comment">#这里通过with timer()的执行逻辑为先记录起始时，执行了fib函数后执行timer的finally代码</span><span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">121</span>):<span class="hljs-keyword">with</span> timer():    print(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;num&#125;</span>: <span class="hljs-subst">&#123;fib(num)&#125;</span>&#x27;</span>)  <span class="hljs-meta">@contextmanager</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">timer</span>():</span>    <span class="hljs-keyword">try</span>:        start = perf_counter()        <span class="hljs-keyword">yield</span>    <span class="hljs-keyword">finally</span>:        end = perf_counter()        print(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;end - start&#125;</span>秒&#x27;</span>)</code></pre></li></ul><h1 id="贪婪法"><a href="#贪婪法" class="headerlink" title="贪婪法"></a>贪婪法</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">贪婪法：在对问题求解时，总是做出在当前看来是最好的选择，</span><span class="hljs-string">不追求最优解，快速找到满意解。</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Thing</span>(<span class="hljs-params">object</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;物品&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, price, weight</span>):</span>        self.name = name        self.price = price        self.weight = weight<span class="hljs-meta">    @property</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">value</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;价格重量比&quot;&quot;&quot;</span>        <span class="hljs-keyword">return</span> self.price / self.weight<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_thing</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;输入物品信息&quot;&quot;&quot;</span>    <span class="hljs-comment">#split()把输入值用空格分割开来</span>    name_str, price_str, weight_str = input().split()    <span class="hljs-keyword">return</span> name_str, int(price_str), int(weight_str)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span>    <span class="hljs-comment">#map函数表示把输入序列值都int()处理</span>    max_weight, num_of_things = map(int, input().split())    all_things = []    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(num_of_things):    <span class="hljs-comment">#*input_thing()作可变参数，为一组列表值</span>        all_things.append(Thing(*input_thing()))    all_things.sort(key=<span class="hljs-keyword">lambda</span> x: x.value, reverse=<span class="hljs-literal">True</span>)    total_weight = <span class="hljs-number">0</span>    total_price = <span class="hljs-number">0</span>    <span class="hljs-keyword">for</span> thing <span class="hljs-keyword">in</span> all_things:        <span class="hljs-keyword">if</span> total_weight + thing.weight &lt;= max_weight:            print(<span class="hljs-string">f&#x27;小偷拿走了<span class="hljs-subst">&#123;thing.name&#125;</span>&#x27;</span>)            total_weight += thing.weight            total_price += thing.price    print(<span class="hljs-string">f&#x27;总价值: <span class="hljs-subst">&#123;total_price&#125;</span>美元&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="递归回溯"><a href="#递归回溯" class="headerlink" title="递归回溯"></a>递归回溯</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">递归回溯法：叫称为试探法，按选优条件向前搜索，当搜索到某一步，</span><span class="hljs-string">发现原先选择并不优或达不到目标时，就退回一步重新选择。</span><span class="hljs-string">经典问题：骑士巡逻</span><span class="hljs-string">&quot;&quot;&quot;</span>SIZE = <span class="hljs-number">5</span>total = <span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_board</span>(<span class="hljs-params">board</span>):</span>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> board:        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> row:        <span class="hljs-comment">#打印棋盘，center(4)将字符串居中填充空格至长度为</span>            print(str(col).center(<span class="hljs-number">4</span>), end=<span class="hljs-string">&#x27;&#x27;</span>)        print()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">patrol</span>(<span class="hljs-params">board, row, col, step=<span class="hljs-number">1</span></span>):</span><span class="hljs-comment">#判定条件：行列值在棋盘范围内，所走的格子是0</span>    <span class="hljs-keyword">if</span> row &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> row &lt; SIZE <span class="hljs-keyword">and</span> \        col &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> col &lt; SIZE <span class="hljs-keyword">and</span> \        board[row][col] == <span class="hljs-number">0</span>:        board[row][col] = step        <span class="hljs-keyword">if</span> step == SIZE * SIZE:            <span class="hljs-keyword">global</span> total            total += <span class="hljs-number">1</span>            print(<span class="hljs-string">f&#x27;第<span class="hljs-subst">&#123;total&#125;</span>种走法: &#x27;</span>)            print_board(board)        patrol(board, row - <span class="hljs-number">2</span>, col - <span class="hljs-number">1</span>, step + <span class="hljs-number">1</span>)        patrol(board, row - <span class="hljs-number">1</span>, col - <span class="hljs-number">2</span>, step + <span class="hljs-number">1</span>)        patrol(board, row + <span class="hljs-number">1</span>, col - <span class="hljs-number">2</span>, step + <span class="hljs-number">1</span>)        patrol(board, row + <span class="hljs-number">2</span>, col - <span class="hljs-number">1</span>, step + <span class="hljs-number">1</span>)        patrol(board, row + <span class="hljs-number">2</span>, col + <span class="hljs-number">1</span>, step + <span class="hljs-number">1</span>)        patrol(board, row + <span class="hljs-number">1</span>, col + <span class="hljs-number">2</span>, step + <span class="hljs-number">1</span>)        patrol(board, row - <span class="hljs-number">1</span>, col + <span class="hljs-number">2</span>, step + <span class="hljs-number">1</span>)        patrol(board, row - <span class="hljs-number">2</span>, col + <span class="hljs-number">1</span>, step + <span class="hljs-number">1</span>)        <span class="hljs-comment">#将走过的格子清零，理解为抹除走过的痕迹</span>        board[row][col] = <span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    board = [[<span class="hljs-number">0</span>] * SIZE <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(SIZE)]    patrol(board, SIZE - <span class="hljs-number">1</span>, SIZE - <span class="hljs-number">1</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">装饰类的装饰器 - 单例模式 - 一个类只能创建出唯一的对象</span><span class="hljs-string">上下文语法：</span><span class="hljs-string">__enter__ / __exit__</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">import</span> threading<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">singleton</span>(<span class="hljs-params">cls</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;单例装饰器&quot;&quot;&quot;</span>    instances = &#123;&#125;    lock = threading.Lock()<span class="hljs-meta">    @wraps(cls)</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):</span>        <span class="hljs-keyword">if</span> cls <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> instances:            <span class="hljs-keyword">with</span> lock:                <span class="hljs-keyword">if</span> cls <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> instances:                    instances[cls] = cls(*args, **kwargs)        <span class="hljs-keyword">return</span> instances[cls]    <span class="hljs-keyword">return</span> wrapper<span class="hljs-meta">@singleton</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">President</span>():</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, country</span>):</span>        self.name = name        self.country = country    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;self.country&#125;</span>: <span class="hljs-subst">&#123;self.name&#125;</span>&#x27;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    print(President.__name__)    p1 = President(<span class="hljs-string">&#x27;特朗普&#x27;</span>, <span class="hljs-string">&#x27;美国&#x27;</span>)    p2 = President(<span class="hljs-string">&#x27;奥巴马&#x27;</span>, <span class="hljs-string">&#x27;美国&#x27;</span>)    print(p1 == p2)    print(p1)    print(p2)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta, abstractmethod<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span>(<span class="hljs-params">metaclass=ABCMeta</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;员工(抽象类)&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span>        self.name = name<span class="hljs-meta">    @abstractmethod</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_salary</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;结算月薪(抽象方法)&quot;&quot;&quot;</span>        <span class="hljs-keyword">pass</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Manager</span>(<span class="hljs-params">Employee</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;部门经理&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_salary</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> <span class="hljs-number">15000.0</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Programmer</span>(<span class="hljs-params">Employee</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;程序员&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, working_hour=<span class="hljs-number">0</span></span>):</span>        self.working_hour = working_hour        super().__init__(name)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_salary</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> <span class="hljs-number">200.0</span> * self.working_hour<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Salesman</span>(<span class="hljs-params">Employee</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;销售员&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, sales=<span class="hljs-number">0.0</span></span>):</span>        self.sales = sales        super().__init__(name)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_salary</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> <span class="hljs-number">1800.0</span> + self.sales * <span class="hljs-number">0.05</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeFactory</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;创建员工的工厂（工厂模式 - 通过工厂实现对象使用者和对象之间的解耦合）&quot;&quot;&quot;</span><span class="hljs-meta">    @staticmethod</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span>(<span class="hljs-params">emp_type, *args, **kwargs</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;创建员工&quot;&quot;&quot;</span>        emp_type = emp_type.upper()        emp = <span class="hljs-literal">None</span>        <span class="hljs-keyword">if</span> emp_type == <span class="hljs-string">&#x27;M&#x27;</span>:            emp = Manager(*args, **kwargs)        <span class="hljs-keyword">elif</span> emp_type == <span class="hljs-string">&#x27;P&#x27;</span>:            emp = Programmer(*args, **kwargs)        <span class="hljs-keyword">elif</span> emp_type == <span class="hljs-string">&#x27;S&#x27;</span>:            emp = Salesman(*args, **kwargs)        <span class="hljs-keyword">return</span> emp<span class="hljs-keyword">from</span> example12 <span class="hljs-keyword">import</span> EmployeeFactory<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span>    emps = [        EmployeeFactory.create(<span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;曹操&#x27;</span>),         EmployeeFactory.create(<span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;荀彧&#x27;</span>, <span class="hljs-number">120</span>),        EmployeeFactory.create(<span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;郭嘉&#x27;</span>, <span class="hljs-number">85</span>),         EmployeeFactory.create(<span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;典韦&#x27;</span>, <span class="hljs-number">123000</span>),    ]    <span class="hljs-keyword">for</span> emp <span class="hljs-keyword">in</span> emps:        print(<span class="hljs-string">&#x27;%s: %.2f元&#x27;</span> % (emp.name, emp.get_salary()))<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum, unique<span class="hljs-keyword">import</span> random<span class="hljs-meta">@unique</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Suite</span>(<span class="hljs-params">Enum</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;花色（枚举）&quot;&quot;&quot;</span>    SPADE, HEART, CLUB, DIAMOND = range(<span class="hljs-number">4</span>)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__lt__</span>(<span class="hljs-params">self, other</span>):</span>        <span class="hljs-keyword">return</span> self.value &lt; other.value<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Card</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;牌&quot;&quot;&quot;</span>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, suite, face</span>):</span>        self.suite = suite        self.face = face    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> self.__str__()    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span>        suites = (<span class="hljs-string">&#x27;♠️&#x27;</span>, <span class="hljs-string">&#x27;♥️&#x27;</span>, <span class="hljs-string">&#x27;♣️&#x27;</span>, <span class="hljs-string">&#x27;♦️&#x27;</span>)        faces = (<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>,                  <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;K&#x27;</span>)        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;suites[self.suite.value]&#125;</span> <span class="hljs-subst">&#123;faces[self.face]&#125;</span>&#x27;</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Poker</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;扑克&quot;&quot;&quot;</span>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        self.index = <span class="hljs-number">0</span>        self.cards = [Card(suite, face)                      <span class="hljs-keyword">for</span> suite <span class="hljs-keyword">in</span> Suite                      <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">14</span>)]    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shuffle</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;洗牌&quot;&quot;&quot;</span>        self.index = <span class="hljs-number">0</span>        random.shuffle(self.cards)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deal</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;发牌&quot;&quot;&quot;</span>        card = self.cards[self.index]        self.index += <span class="hljs-number">1</span>        <span class="hljs-keyword">return</span> card<span class="hljs-meta">    @property</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_more</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;是否有更多的牌&quot;&quot;&quot;</span>        <span class="hljs-keyword">return</span> self.index &lt; len(self.cards)<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;玩家&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span>        self.name = name        self.cards = []    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_card</span>(<span class="hljs-params">self, card</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;摸牌&quot;&quot;&quot;</span>        self.cards.append(card)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">arrange</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;整理手上的牌&quot;&quot;&quot;</span>        self.cards.sort(key=<span class="hljs-keyword">lambda</span> card: (card.suite, card.face))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span>    poker = Poker()    poker.shuffle()    players = [        Player(<span class="hljs-string">&#x27;东邪&#x27;</span>), Player(<span class="hljs-string">&#x27;西毒&#x27;</span>),         Player(<span class="hljs-string">&#x27;南帝&#x27;</span>), Player(<span class="hljs-string">&#x27;北丐&#x27;</span>)    ]    <span class="hljs-keyword">while</span> poker.has_more:        <span class="hljs-keyword">for</span> player <span class="hljs-keyword">in</span> players:            player.get_card(poker.deal())    <span class="hljs-keyword">for</span> player <span class="hljs-keyword">in</span> players:        player.arrange()        print(player.name, end=<span class="hljs-string">&#x27;: &#x27;</span>)        print(player.cards)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><p><strong>生成可迭代序列的工具模块</strong></p><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">迭代器 - __iter__ / __next__</span><span class="hljs-string">itertools - 生成可迭代序列的工具模块</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">import</span> itertools<span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> sqrt<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_prime</span>(<span class="hljs-params">num</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;判断素数&quot;&quot;&quot;</span>    <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>, int(sqrt(num)) + <span class="hljs-number">1</span>):        <span class="hljs-keyword">if</span> num % factor == <span class="hljs-number">0</span>:            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrimeIter</span>(<span class="hljs-params">object</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;素数迭代器&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, min_value, max_value</span>):</span>        <span class="hljs-keyword">assert</span> <span class="hljs-number">2</span> &lt;= min_value &lt;= max_value        self.min_value = min_value - <span class="hljs-number">1</span>        self.max_value = max_value    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__iter__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> self    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__next__</span>(<span class="hljs-params">self</span>):</span>        self.min_value += <span class="hljs-number">1</span>        <span class="hljs-keyword">while</span> self.min_value &lt;= self.max_value:            <span class="hljs-keyword">if</span> is_prime(self.min_value):                <span class="hljs-keyword">return</span> self.min_value            self.min_value += <span class="hljs-number">1</span>        <span class="hljs-keyword">raise</span> StopIteration()<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FibIter</span>(<span class="hljs-params">object</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;斐波那契数迭代器&quot;&quot;&quot;</span>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, num</span>):</span>        self.num = num        self.a, self.b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>        self.idx = <span class="hljs-number">0</span>       <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__iter__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> self    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__next__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">if</span> self.idx &lt; self.num:            self.a, self.b = self.b, self.a + self.b            self.idx += <span class="hljs-number">1</span>            <span class="hljs-keyword">return</span> self.a        <span class="hljs-keyword">raise</span> StopIteration()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-comment"># 输出ABCD的全排列</span><span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> itertools.permutations(<span class="hljs-string">&#x27;ABCD&#x27;</span>):print(val)    <span class="hljs-comment"># 从ABCDE中选3个组合</span>    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> itertools.combinations(<span class="hljs-string">&#x27;ABCDE&#x27;</span>, <span class="hljs-number">3</span>):        print(val)    <span class="hljs-comment"># 分别从黑红梅方和1-13中形成对应组组合</span>    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-string">&#x27;黑红梅方&#x27;</span>, range(<span class="hljs-number">1</span>, <span class="hljs-number">14</span>)):        print(val)    <span class="hljs-comment"># 逐一打印生成斐波那契数数列</span>    fib_iter = FibIter(<span class="hljs-number">20</span>)    print(<span class="hljs-string">&#x27;===&gt;&#x27;</span>, next(fib_iter))    print(<span class="hljs-string">&#x27;===&gt;&#x27;</span>, next(fib_iter))    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> fib_iter:         print(val)    <span class="hljs-comment"># 输出2-100000之间的素数</span>    prime_iter = PrimeIter(<span class="hljs-number">2</span>, <span class="hljs-number">100000</span>)    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> prime_iter:        print(val)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="元"><a href="#元" class="headerlink" title="元"></a>元</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">元 - meta</span><span class="hljs-string">元数据 - 描述数据的数据 - metadata</span><span class="hljs-string">元类 - 描述类的类 - metaclass - 继承自type</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">import</span> threading<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonMeta</span>(<span class="hljs-params">type</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;自定义元类&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">cls, *args, **kwargs</span>):</span>        cls.__instance = <span class="hljs-literal">None</span>        cls.lock = threading.Lock()        super().__init__(*args, **kwargs)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__call__</span>(<span class="hljs-params">cls, *args, **kwargs</span>):</span>        <span class="hljs-keyword">if</span> cls.__instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:            <span class="hljs-keyword">with</span> cls.lock:                <span class="hljs-keyword">if</span> cls.__instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:                    cls.__instance = super().__call__(*args, **kwargs)        <span class="hljs-keyword">return</span> cls.__instance<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">President</span>(<span class="hljs-params">metaclass=SingletonMeta</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;总统(单例类)&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, country</span>):</span>        self.name = name        self.country = country    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;self.country&#125;</span>: <span class="hljs-subst">&#123;self.name&#125;</span>&#x27;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span>    p1 = President(<span class="hljs-string">&#x27;特朗普&#x27;</span>, <span class="hljs-string">&#x27;美国&#x27;</span>)     p2 = President(<span class="hljs-string">&#x27;奥巴马&#x27;</span>, <span class="hljs-string">&#x27;美国&#x27;</span>)    p3 = President.__call__(<span class="hljs-string">&#x27;克林顿&#x27;</span>, <span class="hljs-string">&#x27;美国&#x27;</span>)    print(p1 == p2) <span class="hljs-comment">#True</span>    print(p1 == p3) <span class="hljs-comment">#True</span>    <span class="hljs-comment">#美国: 特朗普</span><span class="hljs-comment">#美国: 特朗普</span><span class="hljs-comment">#美国: 特朗普</span>    print(p1, p2, p3, sep=<span class="hljs-string">&#x27;\n&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">多个线程竞争一个资源 - 保护临界资源 - 锁（Lock/RLock）</span><span class="hljs-string">多个线程竞争多个资源（线程数&gt;资源数） - 信号量（Semaphore）</span><span class="hljs-string">多个线程的调度 - 暂停线程执行/唤醒等待中的线程 - Condition</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<span class="hljs-keyword">import</span> threading<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;银行账户&quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, balance=<span class="hljs-number">0</span></span>):</span>        self.balance = balance        lock = threading.Lock()        self.condition = threading.Condition(lock)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">withdraw</span>(<span class="hljs-params">self, money</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;取钱&quot;&quot;&quot;</span>        <span class="hljs-keyword">with</span> self.condition:            <span class="hljs-comment"># 余额要够才能取钱</span>            <span class="hljs-keyword">while</span> money &gt; self.balance:                self.condition.wait()            new_balance = self.balance - money            sleep(<span class="hljs-number">0.001</span>)            self.balance = new_balance    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deposit</span>(<span class="hljs-params">self, money</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;存钱&quot;&quot;&quot;</span>        <span class="hljs-keyword">with</span> self.condition:            new_balance = self.balance + money            sleep(<span class="hljs-number">0.001</span>)            self.balance = new_balance            self.condition.notify_all()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_money</span>(<span class="hljs-params">account</span>):</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        money = randint(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)        account.deposit(money)        print(threading.current_thread().name,              <span class="hljs-string">&#x27;:&#x27;</span>, money, <span class="hljs-string">&#x27;====&gt;&#x27;</span>, account.balance)        sleep(<span class="hljs-number">0.5</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sub_money</span>(<span class="hljs-params">account</span>):</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        money = randint(<span class="hljs-number">10</span>, <span class="hljs-number">30</span>)        account.withdraw(money)        print(threading.current_thread().name,              <span class="hljs-string">&#x27;:&#x27;</span>, money, <span class="hljs-string">&#x27;&lt;====&#x27;</span>, account.balance)        sleep(<span class="hljs-number">1</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    account = Account()    <span class="hljs-comment">#创建线程池</span>    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> pool:        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):            pool.submit(add_money, account)            pool.submit(sub_money, account)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">多进程和进程池的使用</span><span class="hljs-string">多线程因为GIL的存在不能够发挥CPU的多核特性</span><span class="hljs-string">对于计算密集型任务应该考虑使用多进程</span><span class="hljs-string">time python3 example22.py</span><span class="hljs-string">real    0m11.512s</span><span class="hljs-string">user    0m39.319s</span><span class="hljs-string">sys     0m0.169s</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">import</span> concurrent.futures<span class="hljs-keyword">import</span> mathPRIMES = [    <span class="hljs-number">1116281</span>,    <span class="hljs-number">1297337</span>,    <span class="hljs-number">104395303</span>,    <span class="hljs-number">472882027</span>,    <span class="hljs-number">533000389</span>,    <span class="hljs-number">817504243</span>,    <span class="hljs-number">982451653</span>,    <span class="hljs-number">112272535095293</span>,    <span class="hljs-number">112582705942171</span>,    <span class="hljs-number">112272535095293</span>,    <span class="hljs-number">115280095190773</span>,    <span class="hljs-number">115797848077099</span>,    <span class="hljs-number">1099726899285419</span>] * <span class="hljs-number">5</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_prime</span>(<span class="hljs-params">n</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;判断素数&quot;&quot;&quot;</span>    <span class="hljs-keyword">if</span> n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>    sqrt_n = int(math.floor(math.sqrt(n)))    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>, sqrt_n + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>):        <span class="hljs-keyword">if</span> n % i == <span class="hljs-number">0</span>:            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span>    <span class="hljs-keyword">with</span> concurrent.futures.ProcessPoolExecutor() <span class="hljs-keyword">as</span> executor:        <span class="hljs-keyword">for</span> number, prime <span class="hljs-keyword">in</span> zip(PRIMES, executor.map(is_prime, PRIMES)):            print(<span class="hljs-string">&#x27;%d is prime: %s&#x27;</span> % (number, prime))<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">协程（coroutine）- 可以在需要时进行切换的相互协作的子程序</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">import</span> asyncio<span class="hljs-keyword">from</span> example15 <span class="hljs-keyword">import</span> is_prime<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">num_generator</span>(<span class="hljs-params">m, n</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;指定范围的数字生成器&quot;&quot;&quot;</span>    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> range(m, n + <span class="hljs-number">1</span>)<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prime_filter</span>(<span class="hljs-params">m, n</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;素数过滤器&quot;&quot;&quot;</span>    primes = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> num_generator(m, n):        <span class="hljs-keyword">if</span> is_prime(i):            print(<span class="hljs-string">&#x27;Prime =&gt;&#x27;</span>, i)            primes.append(i)        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.001</span>)    <span class="hljs-keyword">return</span> tuple(primes)<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">square_mapper</span>(<span class="hljs-params">m, n</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;平方映射器&quot;&quot;&quot;</span>    squares = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> num_generator(m, n):        print(<span class="hljs-string">&#x27;Square =&gt;&#x27;</span>, i * i)        squares.append(i * i)        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.001</span>)    <span class="hljs-keyword">return</span> squares<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span>    loop = asyncio.get_event_loop()    future = asyncio.gather(prime_filter(<span class="hljs-number">2</span>, <span class="hljs-number">100</span>), square_mapper(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))    future.add_done_callback(<span class="hljs-keyword">lambda</span> x: print(x.result()))    loop.run_until_complete(future)    loop.close()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:   main()</code></pre><h1 id="异步HTTP访问"><a href="#异步HTTP访问" class="headerlink" title="异步HTTP访问"></a>异步HTTP访问</h1><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">aiohttp - 异步HTTP网络访问</span><span class="hljs-string">异步I/O（异步编程）- 只使用一个线程（单线程）来处理用户请求</span><span class="hljs-string">用户请求一旦被接纳，剩下的都是I/O操作，通过多路I/O复用也可以达到并发的效果</span><span class="hljs-string">这种做法与多线程相比可以让CPU利用率更高，因为没有线程切换的开销</span><span class="hljs-string">Redis/Node.js - 单线程 + 异步I/O</span><span class="hljs-string">Celery - 将要执行的耗时间的任务异步化处理</span><span class="hljs-string">异步I/O事件循环 - uvloop</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">import</span> asyncio<span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> aiohttp<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch</span>(<span class="hljs-params">session, url</span>):</span>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url, ssl=<span class="hljs-literal">False</span>) <span class="hljs-keyword">as</span> resp:        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> resp.text()<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    pattern = re.compile(<span class="hljs-string">r&#x27;\&lt;title\&gt;(?P&lt;title&gt;.*)\&lt;\/title\&gt;&#x27;</span>)    urls = (<span class="hljs-string">&#x27;https://www.python.org/&#x27;</span>,            <span class="hljs-string">&#x27;https://git-scm.com/&#x27;</span>,            <span class="hljs-string">&#x27;https://www.jd.com/&#x27;</span>,            <span class="hljs-string">&#x27;https://www.taobao.com/&#x27;</span>,            <span class="hljs-string">&#x27;https://www.douban.com/&#x27;</span>)    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:            html = <span class="hljs-keyword">await</span> fetch(session, url)            print(pattern.search(html).group(<span class="hljs-string">&#x27;title&#x27;</span>))<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    loop = asyncio.get_event_loop()    loop.run_until_complete(main())    loop.close()</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>语言学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysql命令</title>
    <link href="/2019/07/13/mysql/"/>
    <url>/2019/07/13/mysql/</url>
    
    <content type="html"><![CDATA[<p>这次记录理解学习mysql命令</p><a id="more"></a><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> xx;//创建数据库xx<span class="hljs-keyword">show</span> databases;查看数据库<span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> xx;删除数据库use xx;//进入xx数据库<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> xxx (id <span class="hljs-type">int</span> (<span class="hljs-number">32</span>),username <span class="hljs-type">varchar</span>(<span class="hljs-number">40</span>),<span class="hljs-keyword">password</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>));创建表格式<span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">tables</span>;查看表<span class="hljs-keyword">desc</span> xxx;// 查看表结构<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>();//查看当前表在哪个库下 <span class="hljs-keyword">drop</span> xxx;//删除xxx表<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 原表命 <span class="hljs-keyword">rename</span> 新表明<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx change 字段名 字段名<span class="hljs-number">1</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">66</span>);//修改字段<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx modify 字段名 修改值;//修改字段值<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">drop</span> 字段名;//删除字段<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">add</span> 字段名 <span class="hljs-type">varchar</span>(<span class="hljs-number">55</span>) first;//插入字段到首行<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">add</span> 字段名 <span class="hljs-type">varchar</span>(<span class="hljs-number">55</span>) <span class="hljs-keyword">after</span> 字段名<span class="hljs-number">1</span>;//插入到字段名<span class="hljs-number">1</span>后一行<span class="hljs-keyword">show</span> <span class="hljs-keyword">index</span> <span class="hljs-keyword">from</span> xx;//查看索引情况<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">add</span> <span class="hljs-keyword">index</span>(字段);//给字段加入普通索引 <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span>(字段);//给字段加入唯一索引 <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">add</span> fulltext(字段);//给字段加入全文索引 <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> xx <span class="hljs-keyword">add</span> <span class="hljs-keyword">primary key</span>(字段);//给字段加入主键索引 <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> bbs_user <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;成龙&#x27;</span>,<span class="hljs-number">123123</span>,<span class="hljs-number">64</span>,<span class="hljs-number">223</span>,<span class="hljs-number">333324</span>);//给bbs_user表下插入数据<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> bbs_user(id , username , <span class="hljs-keyword">password</span> , age , email , address ) <span class="hljs-keyword">values</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;萨拉赫&#x27;</span>,<span class="hljs-number">123445</span>,<span class="hljs-number">12</span>,<span class="hljs-number">1231</span>,<span class="hljs-number">123123</span>),(<span class="hljs-string">&#x27;库蒂尼奥&#x27;</span> ，<span class="hljs-number">1231</span>，<span class="hljs-number">13</span>，<span class="hljs-number">1312</span>，<span class="hljs-number">132123</span>);//与上一条命令不同在于自动递增的id字段不用输入直接从username开始就行，也可插入多条数据，更灵活<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user;//查看bbs_user表下的数据<span class="hljs-keyword">select</span> count (*) <span class="hljs-keyword">from</span> bbs_user;//查看bbs_user表下的数据个数<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">where</span> id=<span class="hljs-number">2</span>;//查看bbs_user表下id=<span class="hljs-number">2</span>的数据<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">where</span> id&gt;<span class="hljs-number">2</span>;//查看bbs_user表下id&gt;<span class="hljs-number">2</span>的数据<span class="hljs-keyword">select</span> username, address <span class="hljs-keyword">from</span> bbs_user;//查看bbs_user表下username, address的数据<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span>&lt;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,&gt;;//查看bbs_user表下id为<span class="hljs-number">1</span>，<span class="hljs-number">3</span>，<span class="hljs-number">4</span>，的数据<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;四%&#x27;</span>;//模糊查询，查bbs_user表username开头为四的数据<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%四&#x27;</span>%;//模糊查询，查bbs_user表username有四的数据<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> address;//使bbs_user表根据address字段升排序 <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> address <span class="hljs-keyword">desc</span>;//使bbs_user表根据address字段降排序 <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">password</span>;//将表按照<span class="hljs-keyword">password</span>字段分组，（字段相同不显示）<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">limit</span> <span class="hljs-number">5</span>,<span class="hljs-number">15</span>;//检索记录行<span class="hljs-number">6</span>到行<span class="hljs-number">15</span><span class="hljs-keyword">select</span> username , gname <span class="hljs-keyword">from</span> shop_user <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> shop_goods <span class="hljs-keyword">on</span> shop_user.gid = shop_goods.gid;//内联查询 ，查询两个表对应的数据（一二，二三，看一三）<span class="hljs-keyword">select</span> shop_user.username  <span class="hljs-keyword">from</span> shop_user <span class="hljs-keyword">left join</span> shop_goods <span class="hljs-keyword">on</span> shop_user.gid = shop_goods.gid;//左联查询，以左表为基准<span class="hljs-keyword">select</span> shop_user.username <span class="hljs-keyword">from</span> shop_user <span class="hljs-keyword">right join</span> shop_goods <span class="hljs-keyword">on</span> shop_user.gid = shop_goods.gid;//右联查询，以右表为基准<span class="hljs-keyword">select</span> *<span class="hljs-keyword">from</span> shop_user <span class="hljs-keyword">where</span> gid <span class="hljs-keyword">in</span>(<span class="hljs-keyword">select</span> gid <span class="hljs-keyword">from</span> shop_goods);//查shop_user下有带shop_goods中gid中的值的所有数据<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> bbs_user <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;李敖&#x27;</span>;//删除表中数据<span class="hljs-keyword">update</span> bbs_user <span class="hljs-keyword">set</span> username=<span class="hljs-string">&#x27;安安&#x27;</span>,address=<span class="hljs-string">&#x27;88888&#x27;</span> <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;//把id为<span class="hljs-number">1</span>的数据的username字段改为安安，address字段改为<span class="hljs-number">88888</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>命令</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
